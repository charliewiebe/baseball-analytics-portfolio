<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Charlie Wiebe">
<meta name="dcterms.date" content="2025-10-31">

<title>Batter Swing Decision Model (ERV &amp; SDV), R – Baseball Analytics Projects</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-fd68462179fdb1eb8400a3e2e38edf1e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Baseball Analytics Projects</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.qmd"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#swing-decision-value-sdv-modeling" id="toc-swing-decision-value-sdv-modeling" class="nav-link active" data-scroll-target="#swing-decision-value-sdv-modeling">Swing Decision Value (SDV) Modeling</a>
  <ul class="collapse">
  <li><a href="#swing-decisions-sit-at-the-center-of-modern-hitting-analytics-every-pitch-presents-a-choice-and-the-value-of-swinging-versus-taking-varies-dramatically-with-location-count-pitch-type-and-game-context.-for-this-project-i-built-a-full-expected-run-value-ervbased-swing-decision-model-that-quantifies-this-choice-on-every-pitch-of-the-2025-season.-by-modeling-swing-and-take-outcomes-separately-using-xgboost-estimating-their-run-value-consequences-across-thousands-of-game-states-and-combining-them-into-a-unified-decision-value-the-framework-produces-intuitive-zone-maps-batter-specific-profiles-and-actionable-insights.-this-gives-us-a-scalable-data-driven-way-to-evaluate-decision-qualitymoving-beyond-results-to-measure-the-underlying-process-that-defines-elite-hitters." id="toc-swing-decisions-sit-at-the-center-of-modern-hitting-analytics-every-pitch-presents-a-choice-and-the-value-of-swinging-versus-taking-varies-dramatically-with-location-count-pitch-type-and-game-context.-for-this-project-i-built-a-full-expected-run-value-ervbased-swing-decision-model-that-quantifies-this-choice-on-every-pitch-of-the-2025-season.-by-modeling-swing-and-take-outcomes-separately-using-xgboost-estimating-their-run-value-consequences-across-thousands-of-game-states-and-combining-them-into-a-unified-decision-value-the-framework-produces-intuitive-zone-maps-batter-specific-profiles-and-actionable-insights.-this-gives-us-a-scalable-data-driven-way-to-evaluate-decision-qualitymoving-beyond-results-to-measure-the-underlying-process-that-defines-elite-hitters." class="nav-link" data-scroll-target="#swing-decisions-sit-at-the-center-of-modern-hitting-analytics-every-pitch-presents-a-choice-and-the-value-of-swinging-versus-taking-varies-dramatically-with-location-count-pitch-type-and-game-context.-for-this-project-i-built-a-full-expected-run-value-ervbased-swing-decision-model-that-quantifies-this-choice-on-every-pitch-of-the-2025-season.-by-modeling-swing-and-take-outcomes-separately-using-xgboost-estimating-their-run-value-consequences-across-thousands-of-game-states-and-combining-them-into-a-unified-decision-value-the-framework-produces-intuitive-zone-maps-batter-specific-profiles-and-actionable-insights.-this-gives-us-a-scalable-data-driven-way-to-evaluate-decision-qualitymoving-beyond-results-to-measure-the-underlying-process-that-defines-elite-hitters.">Swing decisions sit at the center of modern hitting analytics: every pitch presents a choice, and the value of swinging versus taking varies dramatically with location, count, pitch type, and game context. For this project, I built a full Expected Run Value (ERV)–based swing decision model that quantifies this choice on every pitch of the 2025 season. By modeling swing and take outcomes separately using XGBoost, estimating their run-value consequences across thousands of game states, and combining them into a unified “decision value,” the framework produces intuitive zone maps, batter-specific profiles, and actionable insights. This gives us a scalable, data-driven way to evaluate decision quality—moving beyond results to measure the underlying process that defines elite hitters.</a></li>
  </ul></li>
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set Up</a></li>
  <li><a href="#cleaning-defining-swings-vs-takes" id="toc-cleaning-defining-swings-vs-takes" class="nav-link" data-scroll-target="#cleaning-defining-swings-vs-takes">Cleaning &amp; defining swings vs takes</a></li>
  <li><a href="#run-value-framework-erv" id="toc-run-value-framework-erv" class="nav-link" data-scroll-target="#run-value-framework-erv">Run value framework (ERV)</a></li>
  <li><a href="#two-model-setup-swing-erv-and-take-erv" id="toc-two-model-setup-swing-erv-and-take-erv" class="nav-link" data-scroll-target="#two-model-setup-swing-erv-and-take-erv">Two-model setup: swing (ERV) and take (ERV)</a></li>
  <li><a href="#helper-predict-ervswing-and-ervtake-for-any-set-of-pitches" id="toc-helper-predict-ervswing-and-ervtake-for-any-set-of-pitches" class="nav-link" data-scroll-target="#helper-predict-ervswing-and-ervtake-for-any-set-of-pitches">Helper: Predict ERV(swing) and ERV(take) for any set of pitches</a></li>
  <li><a href="#compute-ervswing-ervtake-and-decision-value-for-all-pitches" id="toc-compute-ervswing-ervtake-and-decision-value-for-all-pitches" class="nav-link" data-scroll-target="#compute-ervswing-ervtake-and-decision-value-for-all-pitches">Compute ERV(swing), ERV(take) and Decision Value for all pitches</a></li>
  <li><a href="#swing-decision-value-sdv-by-batter" id="toc-swing-decision-value-sdv-by-batter" class="nav-link" data-scroll-target="#swing-decision-value-sdv-by-batter">Swing Decision Value (SDV) by Batter</a></li>
  <li><a href="#sdv-leaderboard-plots" id="toc-sdv-leaderboard-plots" class="nav-link" data-scroll-target="#sdv-leaderboard-plots">SDV Leaderboard Plots</a></li>
  <li><a href="#sdv-decomposition-in-zone-vs-out-of-zone" id="toc-sdv-decomposition-in-zone-vs-out-of-zone" class="nav-link" data-scroll-target="#sdv-decomposition-in-zone-vs-out-of-zone">SDV Decomposition: In-Zone vs Out-of-Zone</a>
  <ul class="collapse">
  <li><a href="#this-gives-a-zone-discipline-vs-chase-discipline-flavor-letting-you-say-things-like" id="toc-this-gives-a-zone-discipline-vs-chase-discipline-flavor-letting-you-say-things-like" class="nav-link" data-scroll-target="#this-gives-a-zone-discipline-vs-chase-discipline-flavor-letting-you-say-things-like">This gives a “zone discipline vs chase discipline” flavor, letting you say things like:</a></li>
  <li><a href="#hitter-x-adds-the-most-value-by-not-chasing-out-of-zone-sdv." id="toc-hitter-x-adds-the-most-value-by-not-chasing-out-of-zone-sdv." class="nav-link" data-scroll-target="#hitter-x-adds-the-most-value-by-not-chasing-out-of-zone-sdv.">Hitter X adds the most value by not chasing (out-of-zone SDV).”</a></li>
  <li><a href="#hitter-y-is-great-at-attacking-in-zone-pitches-but-leaks-value-out-of-the-zone." id="toc-hitter-y-is-great-at-attacking-in-zone-pitches-but-leaks-value-out-of-the-zone." class="nav-link" data-scroll-target="#hitter-y-is-great-at-attacking-in-zone-pitches-but-leaks-value-out-of-the-zone.">Hitter Y is great at attacking in-zone pitches but leaks value out of the zone.”</a></li>
  </ul></li>
  <li><a href="#neutral-decision-value-surface-league-average" id="toc-neutral-decision-value-surface-league-average" class="nav-link" data-scroll-target="#neutral-decision-value-surface-league-average">Neutral Decision Value Surface (league-average)</a></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">Interpretation</a></li>
  <li><a href="#same-plot-but-for-0-2-counts" id="toc-same-plot-but-for-0-2-counts" class="nav-link" data-scroll-target="#same-plot-but-for-0-2-counts">Same plot but for 0-2 counts</a></li>
  <li><a href="#interpretation-1" id="toc-interpretation-1" class="nav-link" data-scroll-target="#interpretation-1">Interpretation</a></li>
  <li><a href="#another-couple-diagnostics" id="toc-another-couple-diagnostics" class="nav-link" data-scroll-target="#another-couple-diagnostics">Another couple diagnostics</a></li>
  <li><a href="#cj-abrams-decision-value-surfaces-by-count-faceted" id="toc-cj-abrams-decision-value-surfaces-by-count-faceted" class="nav-link" data-scroll-target="#cj-abrams-decision-value-surfaces-by-count-faceted">CJ Abrams: Decision Value Surfaces by Count (faceted)</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Batter Swing Decision Model (ERV &amp; SDV), R</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">Batting</div>
    <div class="quarto-category">Machine Learning</div>
    <div class="quarto-category">R</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Charlie Wiebe </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 31, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="swing-decision-value-sdv-modeling" class="level1">
<h1>Swing Decision Value (SDV) Modeling</h1>
<section id="swing-decisions-sit-at-the-center-of-modern-hitting-analytics-every-pitch-presents-a-choice-and-the-value-of-swinging-versus-taking-varies-dramatically-with-location-count-pitch-type-and-game-context.-for-this-project-i-built-a-full-expected-run-value-ervbased-swing-decision-model-that-quantifies-this-choice-on-every-pitch-of-the-2025-season.-by-modeling-swing-and-take-outcomes-separately-using-xgboost-estimating-their-run-value-consequences-across-thousands-of-game-states-and-combining-them-into-a-unified-decision-value-the-framework-produces-intuitive-zone-maps-batter-specific-profiles-and-actionable-insights.-this-gives-us-a-scalable-data-driven-way-to-evaluate-decision-qualitymoving-beyond-results-to-measure-the-underlying-process-that-defines-elite-hitters." class="level3">
<h3 class="anchored" data-anchor-id="swing-decisions-sit-at-the-center-of-modern-hitting-analytics-every-pitch-presents-a-choice-and-the-value-of-swinging-versus-taking-varies-dramatically-with-location-count-pitch-type-and-game-context.-for-this-project-i-built-a-full-expected-run-value-ervbased-swing-decision-model-that-quantifies-this-choice-on-every-pitch-of-the-2025-season.-by-modeling-swing-and-take-outcomes-separately-using-xgboost-estimating-their-run-value-consequences-across-thousands-of-game-states-and-combining-them-into-a-unified-decision-value-the-framework-produces-intuitive-zone-maps-batter-specific-profiles-and-actionable-insights.-this-gives-us-a-scalable-data-driven-way-to-evaluate-decision-qualitymoving-beyond-results-to-measure-the-underlying-process-that-defines-elite-hitters.">Swing decisions sit at the center of modern hitting analytics: every pitch presents a choice, and the value of swinging versus taking varies dramatically with location, count, pitch type, and game context. For this project, I built a full Expected Run Value (ERV)–based swing decision model that quantifies this choice on every pitch of the 2025 season. By modeling swing and take outcomes separately using XGBoost, estimating their run-value consequences across thousands of game states, and combining them into a unified “decision value,” the framework produces intuitive zone maps, batter-specific profiles, and actionable insights. This gives us a scalable, data-driven way to evaluate decision quality—moving beyond results to measure the underlying process that defines elite hitters.</h3>
</section>
</section>
<section id="set-up" class="level1">
<h1>Set Up</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix) <span class="co"># For XGBoost</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>statcast_2025 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"statcast_2025.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>DT <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(statcast_2025)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>batter_name_from_des <span class="ot">&lt;-</span> statcast_2025 <span class="sc">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(des)) <span class="sc">%&gt;%</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract batter name before common verbs: "grounds", "singles", etc.</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">batter_name_guess =</span> <span class="fu">str_extract</span>(</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      des,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">"^[^,]+?(?= grounds| singles| homers| lines| flies| strikes| walks| hits| bunts| pops| reaches)"</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(batter_name_guess)) <span class="sc">%&gt;%</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(batter) <span class="sc">%&gt;%</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_rows  =</span> <span class="fu">n</span>(),</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_names =</span> <span class="fu">n_distinct</span>(batter_name_guess),</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">batter_name =</span> <span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">table</span>(batter_name_guess), <span class="at">decreasing =</span> <span class="cn">TRUE</span>))[<span class="dv">1</span>],</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="cleaning-defining-swings-vs-takes" class="level1">
<h1>Cleaning &amp; defining swings vs takes</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> statcast_2025 <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(game_year <span class="sc">==</span> <span class="dv">2025</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>         game_type <span class="sc">==</span> <span class="st">"R"</span>, <span class="co"># Only regular season</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"bunt"</span>, description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>         events <span class="sc">!=</span> <span class="st">"intent_walk"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>swing_descriptions <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"swinging_strike"</span>, <span class="st">"foul"</span>, <span class="st">"hit_into_play"</span>, <span class="st">"swinging_strike_blocked"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"foul_tip"</span>, <span class="st">"foul_bunt"</span>, <span class="st">"missed_bunt"</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> sc <span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">description_clean =</span> <span class="fu">tolower</span>(description),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_swing =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"X"</span> <span class="sc">~</span> <span class="dv">1</span>L, <span class="co"># ball in play</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(description_clean, <span class="fu">paste</span>(swing_descriptions, <span class="at">collapse =</span> <span class="st">"|"</span>)) <span class="sc">~</span> <span class="dv">1</span>L,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>L</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="run-value-framework-erv" class="level1">
<h1>Run value framework (ERV)</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> sc <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rv =</span> delta_run_exp)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> sc <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">event_cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"single"</span>) <span class="sc">~</span> <span class="st">"1B"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"double"</span>) <span class="sc">~</span> <span class="st">"2B"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"triple"</span>) <span class="sc">~</span> <span class="st">"3B"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"home_run"</span>) <span class="sc">~</span> <span class="st">"HR"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"walk"</span>, <span class="st">"hit_by_pitch"</span>, <span class="st">"intent_walk"</span>) <span class="sc">~</span> <span class="st">"BB_HBP"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"strikeout"</span>) <span class="sc">&amp;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(description_clean, <span class="st">"swinging"</span>) <span class="sc">~</span> <span class="st">"K_swing"</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"strikeout"</span>) <span class="sc">&amp;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(description_clean, <span class="st">"called"</span>) <span class="sc">~</span> <span class="st">"K_look"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"B"</span> <span class="sc">~</span> <span class="st">"ball"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"S"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(description_clean, <span class="st">"called_strike"</span>) <span class="sc">~</span> <span class="st">"called_strike"</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"S"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(description_clean, <span class="st">"foul"</span>) <span class="sc">~</span> <span class="st">"foul"</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"S"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(description_clean, <span class="st">"swinging"</span>) <span class="sc">~</span> <span class="st">"swing_miss"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"X"</span> <span class="sc">&amp;</span> events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"field_error"</span>) <span class="sc">~</span> <span class="st">"reach_error"</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"X"</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(events) <span class="sc">~</span> <span class="st">"inplay_out"</span>, <span class="co"># misc outs</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"other"</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity check</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(sc<span class="sc">$</span>event_cat)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
           1B            2B            3B          ball        BB_HBP 
        26115          7745           628           238         16722 
called_strike          foul            HR        K_look       K_swing 
           94          2935          5650          9363         28247 
        other   reach_error    swing_miss 
        83752          1010           118 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> sc <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_state =</span> <span class="fu">paste0</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(on_1b), <span class="st">"1"</span>, <span class="st">"0"</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(on_2b), <span class="st">"1"</span>, <span class="st">"0"</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(on_3b), <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">count_str =</span> <span class="fu">paste0</span>(balls, <span class="st">"-"</span>, strikes),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_id  =</span> <span class="fu">paste</span>(base_state, outs_when_up, count_str, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="two-model-setup-swing-erv-and-take-erv" class="level1">
<h1>Two-model setup: swing (ERV) and take (ERV)</h1>
</section>
<section id="helper-predict-ervswing-and-ervtake-for-any-set-of-pitches" class="level1">
<h1>Helper: Predict ERV(swing) and ERV(take) for any set of pitches</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This function:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Uses `xgb_swing` and `xgb_take` to get outcome probabilities.  </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Looks up the RV for each `(event_cat, state_id)`.  </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Returns `ERV_swing` and `ERV_take` per row.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: get RV vector for a given state_id (with global fallback)</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>get_rv_vec <span class="ot">&lt;-</span> <span class="cf">function</span>(state_id_i) {</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># RV for that state</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  rv_i <span class="ot">&lt;-</span> rv_lookup <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(state_id <span class="sc">==</span> state_id_i)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(rv_i) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback: use global RV by event</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    rv_i <span class="ot">&lt;-</span> rv_global <span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">avg_rv =</span> avg_rv_global)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Align with event_levels</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  rv_vec <span class="ot">&lt;-</span> rv_i<span class="sc">$</span>avg_rv[<span class="fu">match</span>(event_levels, rv_i<span class="sc">$</span>event_cat)]</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replace NA with 0 (rare events with no RV estimate)</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  rv_vec[<span class="fu">is.na</span>(rv_vec)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  rv_vec</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Main function: ERV for swing vs take</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>predict_erv_decision <span class="ot">&lt;-</span> <span class="cf">function</span>(X_mat, state_vec) {</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X_mat)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  C <span class="ot">&lt;-</span> <span class="fu">length</span>(event_levels)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Predict probabilities</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  pswing <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_swing, <span class="at">newdata =</span> X_mat)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  ptake  <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_take,  <span class="at">newdata =</span> X_mat)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reshape to n x C</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  pswing <span class="ot">&lt;-</span> <span class="fu">matrix</span>(pswing, <span class="at">nrow =</span> n, <span class="at">ncol =</span> C, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  ptake  <span class="ot">&lt;-</span> <span class="fu">matrix</span>(ptake,  <span class="at">nrow =</span> n, <span class="at">ncol =</span> C, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(pswing) <span class="ot">&lt;-</span> event_levels</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(ptake)  <span class="ot">&lt;-</span> event_levels</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  erv_swing <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  erv_take  <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n)) {</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    rv_vec <span class="ot">&lt;-</span> <span class="fu">get_rv_vec</span>(state_vec[i])</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    erv_swing[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(pswing[i, ] <span class="sc">*</span> rv_vec)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    erv_take[i]  <span class="ot">&lt;-</span> <span class="fu">sum</span>(ptake[i, ]  <span class="sc">*</span> rv_vec)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">erv_swing =</span> erv_swing,</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">erv_take  =</span> erv_take</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="compute-ervswing-ervtake-and-decision-value-for-all-pitches" class="level1">
<h1>Compute ERV(swing), ERV(take) and Decision Value for all pitches</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here I apply the helper to **every modeled pitch**, then compute **decision value** per pitch and aggregate to SDV.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ERV for all modeled pitches</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>erv_all <span class="ot">&lt;-</span> <span class="fu">predict_erv_decision</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">X_mat    =</span> X_full,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">state_vec =</span> sc_model<span class="sc">$</span>state_id</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Decision value per pitch:</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># if swing:   DV = ERV_swing - ERV_take</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># if take:    DV = ERV_take  - ERV_swing</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>sc_results <span class="ot">&lt;-</span> sc_model <span class="sc">%&gt;%</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">erv_swing_hat   =</span> erv_all<span class="sc">$</span>erv_swing,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">erv_take_hat    =</span> erv_all<span class="sc">$</span>erv_take,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">decision_value  =</span> <span class="fu">ifelse</span>(is_swing <span class="sc">==</span> <span class="dv">1</span>L,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                             erv_swing_hat <span class="sc">-</span> erv_take_hat,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                             erv_take_hat  <span class="sc">-</span> erv_swing_hat)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>sc_results_named <span class="ot">&lt;-</span> sc_results <span class="sc">%&gt;%</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    batter_name_from_des <span class="sc">%&gt;%</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(batter, batter_name),</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"batter"</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback label if we couldn't parse a name from des</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">batter_name =</span> <span class="fu">if_else</span>(</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(batter_name),</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"Unknown_"</span>, batter),</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>      batter_name</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="swing-decision-value-sdv-by-batter" class="level1">
<h1>Swing Decision Value (SDV) by Batter</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sdv_batter <span class="ot">&lt;-</span> sc_results_named <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(batter, batter_name) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_pitches =</span> <span class="fu">n</span>(),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_swings  =</span> <span class="fu">sum</span>(is_swing),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_dv  =</span> <span class="fu">sum</span>(decision_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_dv   =</span> <span class="fu">mean</span>(decision_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">dv_per_100_decisions =</span> <span class="dv">100</span> <span class="sc">*</span> mean_dv,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Minimum opportunities filter (I picked 150 arbitrarily)</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_pitches <span class="sc">&gt;=</span> <span class="dv">150</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dv_per_100_decisions))</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>sdv_batter</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["batter"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["batter_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["n_pitches"],"name":[3],"type":["int"],"align":["right"]},{"label":["n_swings"],"name":[4],"type":["int"],"align":["right"]},{"label":["total_dv"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["mean_dv"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["dv_per_100_decisions"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"571970","2":"Max Muncy","3":"386","4":"310","5":"45.70680771","6":"0.1184114189","7":"11.84114189"},{"1":"642136","2":"Matt Thaiss","3":"191","4":"147","5":"22.13098802","6":"0.1158690472","7":"11.58690472"},{"1":"663368","2":"Blake Perkins","3":"171","4":"143","5":"17.68407659","6":"0.1034156525","7":"10.34156525"},{"1":"650402","2":"Gleyber Torres","3":"629","4":"503","5":"64.60507407","6":"0.1027107696","7":"10.27107696"},{"1":"669257","2":"Will Smith","3":"437","4":"339","5":"44.68870156","6":"0.1022624750","7":"10.22624750"},{"1":"670042","2":"Luke Raley","3":"219","4":"182","5":"22.28477234","6":"0.1017569513","7":"10.17569513"},{"1":"660670","2":"Ronald Acuña Jr.","3":"408","4":"324","5":"40.57017413","6":"0.0994367013","7":"9.94367013"},{"1":"672695","2":"Geraldo Perdomo","3":"722","4":"588","5":"70.82721563","6":"0.0980986366","7":"9.80986366"},{"1":"661388","2":"William Contreras","3":"656","4":"548","5":"63.64238326","6":"0.0970158281","7":"9.70158281"},{"1":"643565","2":"Mike Tauchman","3":"385","4":"316","5":"37.09730650","6":"0.0963566402","7":"9.63566402"},{"1":"669743","2":"Alex Call","3":"324","4":"266","5":"31.15517150","6":"0.0961579367","7":"9.61579367"},{"1":"663656","2":"Kyle Tucker","3":"590","4":"485","5":"55.93408580","6":"0.0948035353","7":"9.48035353"},{"1":"689414","2":"Liam Hicks","3":"392","4":"320","5":"37.01143733","6":"0.0944169320","7":"9.44169320"},{"1":"665742","2":"Juan Soto","3":"703","4":"541","5":"65.44079355","6":"0.0930878998","7":"9.30878998"},{"1":"671056","2":"Iván Herrera","3":"451","4":"375","5":"41.95038209","6":"0.0930163683","7":"9.30163683"},{"1":"702332","2":"Caleb Durbin","3":"507","4":"439","5":"46.71288325","6":"0.0921358644","7":"9.21358644"},{"1":"686555","2":"Isaac Collins","3":"442","4":"347","5":"40.43594626","6":"0.0914840413","7":"9.14840413"},{"1":"694497","2":"Evan Carter","3":"219","4":"187","5":"19.65530616","6":"0.0897502564","7":"8.97502564"},{"1":"676914","2":"Davis Schneider","3":"227","4":"176","5":"20.36683564","6":"0.0897217429","7":"8.97217429"},{"1":"664774","2":"LaMonte Wade Jr.","3":"241","4":"196","5":"21.47091852","6":"0.0890909482","7":"8.90909482"},{"1":"670623","2":"Isaac Paredes","3":"439","4":"356","5":"38.76478025","6":"0.0883024607","7":"8.83024607"},{"1":"663697","2":"Jonathan India","3":"566","4":"469","5":"49.28821932","6":"0.0870816596","7":"8.70816596"},{"1":"641933","2":"Tyler O'Neill","3":"208","4":"174","5":"18.03928493","6":"0.0867273314","7":"8.67273314"},{"1":"624424","2":"Michael Conforto","3":"488","4":"388","5":"41.92871471","6":"0.0859194974","7":"8.59194974"},{"1":"643376","2":"Danny Jansen","3":"340","4":"270","5":"29.17277261","6":"0.0858022724","7":"8.58022724"},{"1":"542303","2":"Marcell Ozuna","3":"590","4":"442","5":"50.53787716","6":"0.0856574189","7":"8.56574189"},{"1":"670770","2":"TJ Friedl","3":"687","4":"565","5":"58.55259129","6":"0.0852293905","7":"8.52293905"},{"1":"681715","2":"Heriberto Hernández","3":"296","4":"237","5":"25.21236148","6":"0.0851768969","7":"8.51768969"},{"1":"696030","2":"Alejandro Osuna","3":"175","4":"143","5":"14.81432611","6":"0.0846532921","7":"8.46532921"},{"1":"669065","2":"Kyle Stowers","3":"454","4":"382","5":"38.39513586","6":"0.0845707838","7":"8.45707838"},{"1":"681807","2":"David Fry","3":"157","4":"136","5":"13.23014220","6":"0.0842684217","7":"8.42684217"},{"1":"664023","2":"Ian Happ","3":"661","4":"532","5":"55.66045202","6":"0.0842064327","7":"8.42064327"},{"1":"668715","2":"Spencer Steer","3":"568","4":"489","5":"47.74666403","6":"0.0840610282","7":"8.40610282"},{"1":"656305","2":"Matt Chapman","3":"535","4":"430","5":"44.65009616","6":"0.0834581237","7":"8.34581237"},{"1":"656976","2":"Pavin Smith","3":"287","4":"226","5":"23.88055133","6":"0.0832074959","7":"8.32074959"},{"1":"678246","2":"Miguel Vargas","3":"570","4":"479","5":"47.23505205","6":"0.0828685124","7":"8.28685124"},{"1":"543807","2":"George Springer","3":"583","4":"476","5":"48.10409394","6":"0.0825113104","7":"8.25113104"},{"1":"607043","2":"Brandon Nimmo","3":"651","4":"563","5":"53.64565598","6":"0.0824050015","7":"8.24050015"},{"1":"641343","2":"Jake Bauers","3":"218","4":"165","5":"17.95955750","6":"0.0823832913","7":"8.23832913"},{"1":"681082","2":"Bryson Stott","3":"562","4":"482","5":"46.22844937","6":"0.0822570273","7":"8.22570273"},{"1":"656555","2":"Rhys Hoskins","3":"326","4":"266","5":"26.81154530","6":"0.0822440040","7":"8.22440040"},{"1":"668930","2":"Brice Turang","3":"658","4":"560","5":"54.06911698","6":"0.0821719103","7":"8.21719103"},{"1":"670231","2":"John Rave","3":"175","4":"145","5":"14.35453151","6":"0.0820258943","7":"8.20258943"},{"1":"502054","2":"Tommy Pham","3":"447","4":"370","5":"36.40964853","6":"0.0814533524","7":"8.14533524"},{"1":"641598","2":"Mitch Garver","3":"289","4":"236","5":"23.49022965","6":"0.0812810715","7":"8.12810715"},{"1":"700337","2":"Edgar Quero","3":"403","4":"354","5":"32.72649055","6":"0.0812071726","7":"8.12071726"},{"1":"663757","2":"Trent Grisham","3":"582","4":"451","5":"46.96163418","6":"0.0806900931","7":"8.06900931"},{"1":"527038","2":"Wilmer Flores","3":"464","4":"408","5":"37.30045156","6":"0.0803889042","7":"8.03889042"},{"1":"608324","2":"Alex Bregman","3":"493","4":"420","5":"39.60669224","6":"0.0803381181","7":"8.03381181"},{"1":"592885","2":"Christian Yelich","3":"641","4":"539","5":"50.91585020","6":"0.0794319036","7":"7.94319036"},{"1":"679529","2":"Spencer Torkelson","3":"643","4":"529","5":"50.98138497","6":"0.0792867573","7":"7.92867573"},{"1":"457705","2":"Andrew McCutchen","3":"547","4":"460","5":"43.35077553","6":"0.0792518748","7":"7.92518748"},{"1":"668885","2":"Austin Martin","3":"181","4":"148","5":"14.28741993","6":"0.0789360217","7":"7.89360217"},{"1":"630105","2":"Jake Cronenworth","3":"516","4":"403","5":"40.26171092","6":"0.0780265716","7":"7.80265716"},{"1":"691026","2":"Masyn Winn","3":"538","4":"484","5":"41.92331264","6":"0.0779243729","7":"7.79243729"},{"1":"687462","2":"Spencer Horwitz","3":"410","4":"351","5":"31.90270916","6":"0.0778114858","7":"7.78114858"},{"1":"645444","2":"Jose Herrera","3":"204","4":"158","5":"15.85514763","6":"0.0777213119","7":"7.77213119"},{"1":"641487","2":"J.P. Crawford","3":"654","4":"549","5":"50.79911422","6":"0.0776744866","7":"7.76744866"},{"1":"680474","2":"Max Schuemann","3":"213","4":"178","5":"16.49920067","6":"0.0774610360","7":"7.74610360"},{"1":"592450","2":"Aaron Judge","3":"642","4":"512","5":"49.61897590","6":"0.0772881244","7":"7.72881244"},{"1":"573262","2":"Mike Yastrzemski","3":"554","4":"456","5":"42.64895851","6":"0.0769836796","7":"7.69836796"},{"1":"807712","2":"Luke Keaschall","3":"207","4":"173","5":"15.88075866","6":"0.0767186409","7":"7.67186409"},{"1":"670764","2":"Taylor Walls","3":"317","4":"276","5":"24.25836316","6":"0.0765248049","7":"7.65248049"},{"1":"677800","2":"Wilyer Abreu","3":"412","4":"361","5":"31.27917899","6":"0.0759203374","7":"7.59203374"},{"1":"641857","2":"Ryan McMahon","3":"587","4":"475","5":"44.29522495","6":"0.0754603492","7":"7.54603492"},{"1":"628451","2":"Andy Ibáñez","3":"193","4":"171","5":"14.53280731","6":"0.0752995197","7":"7.52995197"},{"1":"595777","2":"Jurickson Profar","3":"371","4":"302","5":"27.84844187","6":"0.0750631856","7":"7.50631856"},{"1":"665966","2":"Carlos Narváez","3":"446","4":"389","5":"33.46368779","6":"0.0750306901","7":"7.50306901"},{"1":"643446","2":"Jeff McNeil","3":"458","4":"393","5":"34.22327563","6":"0.0747233092","7":"7.47233092"},{"1":"608348","2":"Carson Kelly","3":"422","4":"341","5":"31.42696005","6":"0.0744714693","7":"7.44714693"},{"1":"666185","2":"Dylan Carlson","3":"242","4":"206","5":"17.90353629","6":"0.0739815549","7":"7.39815549"},{"1":"621493","2":"Taylor Ward","3":"663","4":"526","5":"49.01644137","6":"0.0739312841","7":"7.39312841"},{"1":"702284","2":"Cole Young","3":"256","4":"214","5":"18.91751087","6":"0.0738965268","7":"7.38965268"},{"1":"670242","2":"Matt Wallner","3":"393","4":"304","5":"28.99132227","6":"0.0737692679","7":"7.37692679"},{"1":"691019","2":"Kyle Teel","3":"297","4":"228","5":"21.69226459","6":"0.0730379279","7":"7.30379279"},{"1":"596019","2":"Francisco Lindor","3":"730","4":"635","5":"53.27695206","6":"0.0729821261","7":"7.29821261"},{"1":"669701","2":"Josh Smith","3":"562","4":"471","5":"40.73810169","6":"0.0724877254","7":"7.24877254"},{"1":"677587","2":"Brayan Rocchio","3":"384","4":"338","5":"27.80358619","6":"0.0724051724","7":"7.24051724"},{"1":"665487","2":"Fernando Tatis Jr.","3":"685","4":"568","5":"49.42795962","6":"0.0721576053","7":"7.21576053"},{"1":"664702","2":"Myles Straw","3":"299","4":"263","5":"21.35805590","6":"0.0714316251","7":"7.14316251"},{"1":"669289","2":"Santiago Espinal","3":"330","4":"300","5":"23.56352399","6":"0.0714046182","7":"7.14046182"},{"1":"666158","2":"Gavin Lux","3":"505","4":"394","5":"36.03886342","6":"0.0713640860","7":"7.13640860"},{"1":"669221","2":"Sean Murphy","3":"336","4":"269","5":"23.96064911","6":"0.0713114557","7":"7.13114557"},{"1":"672386","2":"Alejandro Kirk","3":"504","4":"449","5":"35.91260351","6":"0.0712551657","7":"7.12551657"},{"1":"671289","2":"Tyler Freeman","3":"428","4":"368","5":"30.48092550","6":"0.0712171157","7":"7.12171157"},{"1":"669707","2":"Jared Triolo","3":"377","4":"313","5":"26.69714350","6":"0.0708147042","7":"7.08147042"},{"1":"553869","2":"Elias Díaz","3":"283","4":"251","5":"19.96506169","6":"0.0705479212","7":"7.05479212"},{"1":"606192","2":"Teoscar Hernández","3":"545","4":"503","5":"38.35145994","6":"0.0703696513","7":"7.03696513"},{"1":"669236","2":"Jeremiah Jackson","3":"185","4":"168","5":"12.99302304","6":"0.0702325570","7":"7.02325570"},{"1":"664059","2":"Sam Haggerty","3":"182","4":"160","5":"12.75053419","6":"0.0700578802","7":"7.00578802"},{"1":"808982","2":"Jung Hoo Lee","3":"616","4":"546","5":"43.03074718","6":"0.0698551091","7":"6.98551091"},{"1":"701358","2":"Cam Smith","3":"495","4":"409","5":"34.52621081","6":"0.0697499208","7":"6.97499208"},{"1":"687231","2":"Darell Hernaiz","3":"197","4":"176","5":"13.73257992","6":"0.0697085275","7":"6.97085275"},{"1":"646240","2":"Rafael Devers","3":"720","4":"572","5":"50.08236721","6":"0.0695588434","7":"6.95588434"},{"1":"694671","2":"Wyatt Langford","3":"571","4":"442","5":"39.70198170","6":"0.0695306159","7":"6.95306159"},{"1":"545361","2":"Mike Trout","3":"548","4":"408","5":"37.81047495","6":"0.0689972171","7":"6.89972171"},{"1":"668709","2":"JJ Bleday","3":"342","4":"291","5":"23.58226371","6":"0.0689539875","7":"6.89539875"},{"1":"543760","2":"Marcus Semien","3":"535","4":"466","5":"36.45779389","6":"0.0681454091","7":"6.81454091"},{"1":"605141","2":"Mookie Betts","3":"662","4":"583","5":"45.01661602","6":"0.0680009305","7":"6.80009305"},{"1":"656941","2":"Kyle Schwarber","3":"719","4":"560","5":"48.85051072","6":"0.0679422959","7":"6.79422959"},{"1":"683737","2":"Michael Busch","3":"591","4":"482","5":"40.10640022","6":"0.0678619293","7":"6.78619293"},{"1":"606115","2":"Orlando Arcia","3":"214","4":"198","5":"14.52216872","6":"0.0678606015","7":"6.78606015"},{"1":"673548","2":"Seiya Suzuki","3":"649","4":"528","5":"43.89293615","6":"0.0676316428","7":"6.76316428"},{"1":"649966","2":"Luis Urías","3":"331","4":"272","5":"22.35682656","6":"0.0675432827","7":"6.75432827"},{"1":"575929","2":"Willson Contreras","3":"562","4":"463","5":"37.90226188","6":"0.0674417471","7":"6.74417471"},{"1":"665862","2":"Jazz Chisholm Jr.","3":"529","4":"426","5":"35.40007965","6":"0.0669188651","7":"6.69188651"},{"1":"805367","2":"Chase Meidroth","3":"505","4":"433","5":"33.64374337","6":"0.0666212740","7":"6.66212740"},{"1":"701762","2":"Nick Kurtz","3":"487","4":"385","5":"32.25881019","6":"0.0662398567","7":"6.62398567"},{"1":"572233","2":"Christian Walker","3":"639","4":"561","5":"42.22003639","6":"0.0660720444","7":"6.60720444"},{"1":"624428","2":"Adam Frazier","3":"458","4":"410","5":"30.06199041","6":"0.0656375336","7":"6.56375336"},{"1":"680757","2":"Steven Kwan","3":"696","4":"616","5":"45.48860430","6":"0.0653571901","7":"6.53571901"},{"1":"456781","2":"Donovan Solano","3":"180","4":"165","5":"11.75575217","6":"0.0653097343","7":"6.53097343"},{"1":"679845","2":"Nick Loftin","3":"188","4":"164","5":"12.22666130","6":"0.0650354325","7":"6.50354325"},{"1":"666134","2":"Nolan Jones","3":"405","4":"327","5":"26.28054595","6":"0.0648902369","7":"6.48902369"},{"1":"662139","2":"Daulton Varsho","3":"270","4":"242","5":"17.48989850","6":"0.0647774018","7":"6.47774018"},{"1":"608701","2":"Rob Refsnyder","3":"210","4":"171","5":"13.59896986","6":"0.0647569993","7":"6.47569993"},{"1":"596146","2":"Max Kepler","3":"472","4":"396","5":"30.51523823","6":"0.0646509285","7":"6.46509285"},{"1":"668804","2":"Bryan Reynolds","3":"653","4":"551","5":"42.21067556","6":"0.0646411571","7":"6.46411571"},{"1":"519317","2":"Giancarlo Stanton","3":"278","4":"232","5":"17.96432526","6":"0.0646198750","7":"6.46198750"},{"1":"680777","2":"Ryan Jeffers","3":"463","4":"374","5":"29.84421837","6":"0.0644583550","7":"6.44583550"},{"1":"702616","2":"Jackson Holliday","3":"649","4":"548","5":"41.69720562","6":"0.0642483908","7":"6.42483908"},{"1":"666023","2":"Freddy Fermin","3":"346","4":"303","5":"22.09209361","6":"0.0638499815","7":"6.38499815"},{"1":"683146","2":"Brett Baty","3":"432","4":"362","5":"27.40548571","6":"0.0634386243","7":"6.34386243"},{"1":"665926","2":"Andrés Giménez","3":"370","4":"328","5":"23.46907998","6":"0.0634299459","7":"6.34299459"},{"1":"666397","2":"Edouard Julien","3":"209","4":"159","5":"13.22663834","6":"0.0632853509","7":"6.32853509"},{"1":"691723","2":"Coby Mayo","3":"293","4":"238","5":"18.49591778","6":"0.0631259993","7":"6.31259993"},{"1":"642715","2":"Willy Adames","3":"684","4":"556","5":"43.16094662","6":"0.0631007992","7":"6.31007992"},{"1":"621566","2":"Matt Olson","3":"722","4":"587","5":"45.54540688","6":"0.0630822810","7":"6.30822810"},{"1":"687363","2":"Victor Scott II","3":"459","4":"381","5":"28.80864484","6":"0.0627639321","7":"6.27639321"},{"1":"668939","2":"Adley Rutschman","3":"367","4":"307","5":"23.01882201","6":"0.0627215859","7":"6.27215859"},{"1":"687221","2":"Dalton Rushing","3":"155","4":"123","5":"9.71607166","6":"0.0626843333","7":"6.26843333"},{"1":"670156","2":"Miles Mastrobuoni","3":"175","4":"152","5":"10.91703073","6":"0.0623830327","7":"6.23830327"},{"1":"650489","2":"Willi Castro","3":"453","4":"374","5":"28.23650805","6":"0.0623322474","7":"6.23322474"},{"1":"669477","2":"Casey Schmitt","3":"347","4":"305","5":"21.47032821","6":"0.0618741447","7":"6.18741447"},{"1":"668227","2":"Randy Arozarena","3":"710","4":"573","5":"43.77248584","6":"0.0616513885","7":"6.16513885"},{"1":"606466","2":"Ketel Marte","3":"550","4":"468","5":"33.70675367","6":"0.0612850067","7":"6.12850067"},{"1":"807713","2":"Matt Shaw","3":"438","4":"380","5":"26.82965070","6":"0.0612549103","7":"6.12549103"},{"1":"657557","2":"Paul DeJong","3":"209","4":"181","5":"12.79532223","6":"0.0612216375","7":"6.12216375"},{"1":"701350","2":"Roman Anthony","3":"303","4":"235","5":"18.54294734","6":"0.0611978460","7":"6.11978460"},{"1":"668942","2":"Josh Rojas","3":"211","4":"180","5":"12.90892932","6":"0.0611797598","7":"6.11797598"},{"1":"700932","2":"Kyle Manzardo","3":"530","4":"450","5":"32.41244878","6":"0.0611555637","7":"6.11555637"},{"1":"620443","2":"Luis Torrens","3":"283","4":"247","5":"17.16240533","6":"0.0606445418","7":"6.06445418"},{"1":"700250","2":"Ben Rice","3":"531","4":"436","5":"32.06641334","6":"0.0603887257","7":"6.03887257"},{"1":"669397","2":"Nick Allen","3":"414","4":"349","5":"24.98061593","6":"0.0603396520","7":"6.03396520"},{"1":"518692","2":"Freddie Freeman","3":"621","4":"549","5":"37.31967638","6":"0.0600960972","7":"6.00960972"},{"1":"694384","2":"Nolan Schanuel","3":"562","4":"476","5":"33.76414840","6":"0.0600785559","7":"6.00785559"},{"1":"805249","2":"Otto Kemp","3":"218","4":"181","5":"13.06770620","6":"0.0599436064","7":"5.99436064"},{"1":"642086","2":"Dominic Smith","3":"225","4":"197","5":"13.44269093","6":"0.0597452930","7":"5.97452930"},{"1":"656716","2":"Zach McKinstry","3":"511","4":"440","5":"30.43207251","6":"0.0595539579","7":"5.95539579"},{"1":"666018","2":"Jonathan Aranda","3":"419","4":"343","5":"24.67583144","6":"0.0588921991","7":"5.88921991"},{"1":"682177","2":"Daniel Schneemann","3":"421","4":"347","5":"24.67529211","6":"0.0586111452","7":"5.86111452"},{"1":"683734","2":"Andrew Vaughn","3":"447","4":"406","5":"26.19645859","6":"0.0586050528","7":"5.86050528"},{"1":"678009","2":"Parker Meadows","3":"213","4":"183","5":"12.44992001","6":"0.0584503287","7":"5.84503287"},{"1":"666139","2":"Josh Lowe","3":"435","4":"388","5":"25.41492056","6":"0.0584251047","7":"5.84251047"},{"1":"641584","2":"Jake Fraley","3":"217","4":"178","5":"12.62653995","6":"0.0581868200","7":"5.81868200"},{"1":"686217","2":"Sal Frelick","3":"594","4":"505","5":"34.53525408","6":"0.0581401584","7":"5.81401584"},{"1":"686948","2":"Drake Baldwin","3":"446","4":"396","5":"25.92221558","6":"0.0581215596","7":"5.81215596"},{"1":"663993","2":"Nathaniel Lowe","3":"608","4":"507","5":"35.17572965","6":"0.0578548185","7":"5.78548185"},{"1":"695734","2":"Daylen Lile","3":"351","4":"313","5":"20.29358196","6":"0.0578164728","7":"5.78164728"},{"1":"683011","2":"Anthony Volpe","3":"597","4":"524","5":"34.48863753","6":"0.0577699121","7":"5.77699121"},{"1":"690993","2":"Colt Keith","3":"467","4":"390","5":"26.84616921","6":"0.0574864437","7":"5.74864437"},{"1":"676609","2":"José Caballero","3":"368","4":"282","5":"21.12033180","6":"0.0573922060","7":"5.73922060"},{"1":"805300","2":"Jakob Marsee","3":"234","4":"193","5":"13.42760221","6":"0.0573829154","7":"5.73829154"},{"1":"660162","2":"Yoán Moncada","3":"287","4":"231","5":"16.38542168","6":"0.0570920616","7":"5.70920616"},{"1":"657656","2":"Ramón Laureano","3":"488","4":"414","5":"27.85268872","6":"0.0570751818","7":"5.70751818"},{"1":"669261","2":"Jack Suwinski","3":"177","4":"130","5":"10.09301170","6":"0.0570226650","7":"5.70226650"},{"1":"680977","2":"Brendan Donovan","3":"514","4":"443","5":"29.12087579","6":"0.0566554004","7":"5.66554004"},{"1":"669224","2":"Austin Wells","3":"448","4":"382","5":"25.31457067","6":"0.0565057381","7":"5.65057381"},{"1":"680574","2":"Matt McLain","3":"576","4":"470","5":"32.13011536","6":"0.0557814503","7":"5.57814503"},{"1":"607208","2":"Trea Turner","3":"641","4":"564","5":"35.66771829","6":"0.0556438663","7":"5.56438663"},{"1":"593871","2":"Jorge Polanco","3":"523","4":"464","5":"28.96329912","6":"0.0553791570","7":"5.53791570"},{"1":"624413","2":"Pete Alonso","3":"704","4":"604","5":"38.97734879","6":"0.0553655523","7":"5.53655523"},{"1":"683002","2":"Gunnar Henderson","3":"645","4":"553","5":"35.51593552","6":"0.0550634659","7":"5.50634659"},{"1":"650490","2":"Yandy Díaz","3":"647","4":"569","5":"35.58628221","6":"0.0550019818","7":"5.50019818"},{"1":"605137","2":"Josh Bell","3":"535","4":"452","5":"29.37479349","6":"0.0549061560","7":"5.49061560"},{"1":"663616","2":"Trevor Larnach","3":"565","4":"485","5":"30.74552169","6":"0.0544168526","7":"5.44168526"},{"1":"624585","2":"Jorge Soler","3":"315","4":"259","5":"17.13139815","6":"0.0543853910","7":"5.43853910"},{"1":"663886","2":"Tyler Stephenson","3":"340","4":"265","5":"18.31423495","6":"0.0538653969","7":"5.38653969"},{"1":"457759","2":"Justin Turner","3":"191","4":"165","5":"10.27863715","6":"0.0538148542","7":"5.38148542"},{"1":"667472","2":"Dane Myers","3":"333","4":"286","5":"17.78545114","6":"0.0534097632","7":"5.34097632"},{"1":"805373","2":"Nacho Alvarez Jr.","3":"210","4":"178","5":"11.21192868","6":"0.0533901366","7":"5.33901366"},{"1":"807799","2":"Masataka Yoshida","3":"205","4":"189","5":"10.92531970","6":"0.0532942425","7":"5.32942425"},{"1":"663457","2":"Lars Nootbaar","3":"580","4":"475","5":"30.63309472","6":"0.0528156805","7":"5.28156805"},{"1":"605170","2":"Victor Caratini","3":"386","4":"328","5":"20.38535438","6":"0.0528117989","7":"5.28117989"},{"1":"692225","2":"Kristian Campbell","3":"263","4":"204","5":"13.88681311","6":"0.0528015708","7":"5.28015708"},{"1":"676694","2":"Jake Meyers","3":"382","4":"316","5":"20.13275789","6":"0.0527035547","7":"5.27035547"},{"1":"672580","2":"Maikel Garcia","3":"668","4":"568","5":"35.09119203","6":"0.0525317246","7":"5.25317246"},{"1":"623168","2":"Tyler Heineman","3":"174","4":"153","5":"9.12442548","6":"0.0524392269","7":"5.24392269"},{"1":"673490","2":"Ha-Seong Kim","3":"191","4":"160","5":"10.01214452","6":"0.0524196048","7":"5.24196048"},{"1":"682998","2":"Corbin Carroll","3":"641","4":"530","5":"33.50743681","6":"0.0522736924","7":"5.22736924"},{"1":"621020","2":"Dansby Swanson","3":"644","4":"575","5":"33.49715335","6":"0.0520142133","7":"5.20142133"},{"1":"666310","2":"Bo Naylor","3":"414","4":"347","5":"21.50674818","6":"0.0519486671","7":"5.19486671"},{"1":"664034","2":"Ty France","3":"491","4":"421","5":"25.20548115","6":"0.0513349922","7":"5.13349922"},{"1":"664728","2":"Kyle Isbel","3":"407","4":"357","5":"20.86770165","6":"0.0512719942","7":"5.12719942"},{"1":"572191","2":"Michael A. Taylor","3":"324","4":"275","5":"16.59193493","6":"0.0512096757","7":"5.12096757"},{"1":"571771","2":"Enrique Hernández","3":"256","4":"225","5":"13.07306440","6":"0.0510666578","7":"5.10666578"},{"1":"686611","2":"Dylan Crews","3":"322","4":"277","5":"16.43823013","6":"0.0510504041","7":"5.10504041"},{"1":"682663","2":"Agustín Ramírez","3":"584","4":"506","5":"29.74743006","6":"0.0509373802","7":"5.09373802"},{"1":"691720","2":"Kyle Karros","3":"156","4":"123","5":"7.92209333","6":"0.0507826495","7":"5.07826495"},{"1":"656775","2":"Cedric Mullins","3":"498","4":"413","5":"25.21935393","6":"0.0506412730","7":"5.06412730"},{"1":"647351","2":"Abraham Toro","3":"284","4":"255","5":"14.32821844","6":"0.0504514734","7":"5.04514734"},{"1":"681393","2":"Connor Norby","3":"337","4":"299","5":"16.93879746","6":"0.0502634940","7":"5.02634940"},{"1":"693304","2":"Nick Gonzales","3":"409","4":"374","5":"20.49204551","6":"0.0501028008","7":"5.01028008"},{"1":"665489","2":"Vladimir Guerrero Jr.","3":"672","4":"563","5":"33.63217748","6":"0.0500478831","7":"5.00478831"},{"1":"695657","2":"Colson Montgomery","3":"283","4":"233","5":"14.12250113","6":"0.0499028308","7":"4.99028308"},{"1":"502671","2":"Paul Goldschmidt","3":"529","4":"471","5":"26.29823959","6":"0.0497131183","7":"4.97131183"},{"1":"657757","2":"Gavin Sheets","3":"545","4":"483","5":"27.06657262","6":"0.0496634360","7":"4.96634360"},{"1":"467793","2":"Carlos Santana","3":"477","4":"397","5":"23.58934255","6":"0.0494535483","7":"4.94535483"},{"1":"592518","2":"Manny Machado","3":"674","4":"595","5":"33.16737065","6":"0.0492097487","7":"4.92097487"},{"1":"657136","2":"Connor Wong","3":"188","4":"160","5":"9.24104767","6":"0.0491545089","7":"4.91545089"},{"1":"672724","2":"Oswald Peraza","3":"265","4":"231","5":"13.01720150","6":"0.0491215151","7":"4.91215151"},{"1":"682641","2":"Luis Matos","3":"184","4":"171","5":"9.03640808","6":"0.0491109135","7":"4.91109135"},{"1":"702176","2":"Alan Roden","3":"153","4":"131","5":"7.51239511","6":"0.0491006216","7":"4.91006216"},{"1":"677942","2":"Blaze Alexander","3":"265","4":"207","5":"12.96659310","6":"0.0489305400","7":"4.89305400"},{"1":"592626","2":"Joc Pederson","3":"305","4":"252","5":"14.88798167","6":"0.0488130547","7":"4.88130547"},{"1":"686469","2":"Vinnie Pasquantino","3":"679","4":"601","5":"33.04222923","6":"0.0486630769","7":"4.86630769"},{"1":"669127","2":"Shea Langeliers","3":"522","4":"459","5":"25.23013985","6":"0.0483336012","7":"4.83336012"},{"1":"672515","2":"Gabriel Moreno","3":"306","4":"270","5":"14.75579742","6":"0.0482215602","7":"4.82215602"},{"1":"547180","2":"Bryce Harper","3":"574","4":"480","5":"27.67174184","6":"0.0482086095","7":"4.82086095"},{"1":"663538","2":"Nico Hoerner","3":"650","4":"587","5":"31.30903949","6":"0.0481677531","7":"4.81677531"},{"1":"677588","2":"José Tena","3":"169","4":"145","5":"8.12534159","6":"0.0480789443","7":"4.80789443"},{"1":"664040","2":"Brandon Lowe","3":"555","4":"497","5":"26.66017245","6":"0.0480363468","7":"4.80363468"},{"1":"691176","2":"Jasson Domínguez","3":"429","4":"355","5":"20.57222418","6":"0.0479539025","7":"4.79539025"},{"1":"681297","2":"Colton Cowser","3":"359","4":"290","5":"17.20430553","6":"0.0479228566","7":"4.79228566"},{"1":"656811","2":"Ryan O'Hearn","3":"543","4":"453","5":"25.83024247","6":"0.0475695073","7":"4.75695073"},{"1":"608369","2":"Corey Seager","3":"435","4":"363","5":"20.46418660","6":"0.0470441071","7":"4.70441071"},{"1":"687597","2":"Jordan Beck","3":"588","4":"506","5":"27.60658444","6":"0.0469499735","7":"4.69499735"},{"1":"666176","2":"Jo Adell","3":"573","4":"488","5":"26.79404139","6":"0.0467609797","7":"4.67609797"},{"1":"695578","2":"James Wood","3":"683","4":"530","5":"31.85902052","6":"0.0466457109","7":"4.66457109"},{"1":"660271","2":"Shohei Ohtani","3":"707","4":"573","5":"32.95163079","6":"0.0466076815","7":"4.66076815"},{"1":"691594","2":"Javier Sanoja","3":"342","4":"310","5":"15.85685318","6":"0.0463650678","7":"4.63650678"},{"1":"645277","2":"Ozzie Albies","3":"666","4":"601","5":"30.71351329","6":"0.0461163863","7":"4.61163863"},{"1":"696285","2":"Jacob Young","3":"364","4":"310","5":"16.52125512","6":"0.0453880635","7":"4.53880635"},{"1":"672640","2":"Otto Lopez","3":"592","4":"530","5":"26.79830879","6":"0.0452674135","7":"4.52674135"},{"1":"671218","2":"Heliot Ramos","3":"693","4":"596","5":"31.27738356","6":"0.0451333096","7":"4.51333096"},{"1":"657077","2":"Alex Verdugo","3":"213","4":"184","5":"9.58523723","6":"0.0450011138","7":"4.50011138"},{"1":"682985","2":"Riley Greene","3":"655","4":"574","5":"29.36800410","6":"0.0448366475","7":"4.48366475"},{"1":"694374","2":"Tim Tawa","3":"225","4":"191","5":"10.07697880","6":"0.0447865725","7":"4.47865725"},{"1":"676059","2":"Jordan Westburg","3":"351","4":"308","5":"15.59854021","6":"0.0444402855","7":"4.44402855"},{"1":"681624","2":"Andy Pages","3":"625","4":"550","5":"27.72170446","6":"0.0443547271","7":"4.43547271"},{"1":"602104","2":"Ramón Urías","3":"391","4":"341","5":"17.33936500","6":"0.0443462020","7":"4.43462020"},{"1":"593428","2":"Xander Bogaerts","3":"554","4":"479","5":"24.55303097","6":"0.0443195505","7":"4.43195505"},{"1":"667670","2":"Brent Rooker","3":"694","4":"592","5":"30.74224908","6":"0.0442971889","7":"4.42971889"},{"1":"608070","2":"José Ramírez","3":"651","4":"590","5":"28.80799352","6":"0.0442519102","7":"4.42519102"},{"1":"666152","2":"David Hamilton","3":"195","4":"166","5":"8.60371005","6":"0.0441215900","7":"4.41215900"},{"1":"668904","2":"Royce Lewis","3":"406","4":"369","5":"17.85025434","6":"0.0439661437","7":"4.39661437"},{"1":"677649","2":"Ezequiel Duran","3":"219","4":"191","5":"9.56713982","6":"0.0436855699","7":"4.36855699"},{"1":"672275","2":"Patrick Bailey","3":"453","4":"386","5":"19.75957422","6":"0.0436193691","7":"4.36193691"},{"1":"656180","2":"Riley Adams","3":"288","4":"252","5":"12.53878487","6":"0.0435374475","7":"4.35374475"},{"1":"672761","2":"Wenceel Pérez","3":"383","4":"329","5":"16.66169137","6":"0.0435031106","7":"4.35031106"},{"1":"681460","2":"Brooks Baldwin","3":"328","4":"287","5":"14.25032364","6":"0.0434461087","7":"4.34461087"},{"1":"623993","2":"Anthony Santander","3":"220","4":"177","5":"9.52886793","6":"0.0433130360","7":"4.33130360"},{"1":"695681","2":"Christian Moore","3":"184","4":"156","5":"7.95914219","6":"0.0432562076","7":"4.32562076"},{"1":"666181","2":"Will Benson","3":"252","4":"228","5":"10.85025054","6":"0.0430565498","7":"4.30565498"},{"1":"596115","2":"Trevor Story","3":"654","4":"588","5":"27.86682931","6":"0.0426098307","7":"4.26098307"},{"1":"543877","2":"Christian Vázquez","3":"216","4":"184","5":"9.18340350","6":"0.0425157569","7":"4.25157569"},{"1":"688363","2":"Graham Pauley","3":"185","4":"155","5":"7.72916752","6":"0.0417792839","7":"4.17792839"},{"1":"664983","2":"Jake McCarthy","3":"223","4":"198","5":"9.30913019","6":"0.0417449784","7":"4.17449784"},{"1":"671221","2":"Drew Waters","3":"219","4":"196","5":"8.97713134","6":"0.0409914673","7":"4.09914673"},{"1":"686681","2":"Michael Massey","3":"277","4":"260","5":"11.31435621","6":"0.0408460513","7":"4.08460513"},{"1":"691016","2":"Tyler Soderstrom","3":"622","4":"521","5":"25.24248650","6":"0.0405827757","7":"4.05827757"},{"1":"666971","2":"Lourdes Gurriel Jr.","3":"546","4":"496","5":"22.10298495","6":"0.0404816574","7":"4.04816574"},{"1":"678882","2":"Ceddanne Rafaela","3":"589","4":"537","5":"23.79076890","6":"0.0403917978","7":"4.03917978"},{"1":"669326","2":"Bryce Teodosio","3":"150","4":"129","5":"6.02728164","6":"0.0401818776","7":"4.01818776"},{"1":"571657","2":"Kyle Farmer","3":"300","4":"267","5":"11.90423713","6":"0.0396807904","7":"3.96807904"},{"1":"621438","2":"Tyrone Taylor","3":"340","4":"294","5":"13.46679820","6":"0.0396082300","7":"3.96082300"},{"1":"545341","2":"Randal Grichuk","3":"292","4":"263","5":"11.49488146","6":"0.0393660324","7":"3.93660324"},{"1":"663853","2":"Romy Gonzalez","3":"340","4":"307","5":"13.33050483","6":"0.0392073672","7":"3.92073672"},{"1":"666149","2":"Tyler Fitzgerald","3":"243","4":"211","5":"9.46925826","6":"0.0389681410","7":"3.89681410"},{"1":"500743","2":"Miguel Rojas","3":"315","4":"279","5":"12.17411565","6":"0.0386479862","7":"3.86479862"},{"1":"664238","2":"Dylan Moore","3":"243","4":"201","5":"9.37763709","6":"0.0385910991","7":"3.85910991"},{"1":"680776","2":"Jarren Duran","3":"696","4":"601","5":"26.75855301","6":"0.0384461969","7":"3.84461969"},{"1":"666624","2":"Christopher Morel","3":"306","4":"242","5":"11.57393212","6":"0.0378233076","7":"3.78233076"},{"1":"669357","2":"Nolan Gorman","3":"401","4":"328","5":"14.99058944","6":"0.0373830161","7":"3.73830161"},{"1":"641355","2":"Cody Bellinger","3":"657","4":"582","5":"24.48043935","6":"0.0372609427","7":"3.72609427"},{"1":"665019","2":"Kody Clemens","3":"386","4":"338","5":"14.30332730","6":"0.0370552521","7":"3.70552521"},{"1":"683766","2":"Christian Koss","3":"191","4":"172","5":"6.98965920","6":"0.0365950743","7":"3.65950743"},{"1":"693307","2":"Dillon Dingler","3":"468","4":"421","5":"16.92703258","6":"0.0361688730","7":"3.61688730"},{"1":"642731","2":"Thairo Estrada","3":"165","4":"155","5":"5.92820264","6":"0.0359285008","7":"3.59285008"},{"1":"663743","2":"Nick Fortes","3":"243","4":"204","5":"8.67284050","6":"0.0356907017","7":"3.56907017"},{"1":"680718","2":"Addison Barger","3":"499","4":"435","5":"17.68239199","6":"0.0354356553","7":"3.54356553"},{"1":"641680","2":"Jonah Heim","3":"435","4":"394","5":"15.27859702","6":"0.0351232115","7":"3.51232115"},{"1":"592663","2":"J.T. Realmuto","3":"549","4":"481","5":"19.19897637","6":"0.0349708131","7":"3.49708131"},{"1":"516782","2":"Starling Marte","3":"329","4":"276","5":"11.43097788","6":"0.0347446136","7":"3.47446136"},{"1":"643217","2":"Andrew Benintendi","3":"470","4":"413","5":"16.29969674","6":"0.0346802058","7":"3.46802058"},{"1":"643289","2":"Mauricio Dubón","3":"398","4":"366","5":"13.76645232","6":"0.0345890762","7":"3.45890762"},{"1":"570482","2":"Gio Urshela","3":"197","4":"177","5":"6.79203758","6":"0.0344773481","7":"3.44773481"},{"1":"660821","2":"Jesús Sánchez","3":"497","4":"430","5":"17.11996898","6":"0.0344466177","7":"3.44466177"},{"1":"621043","2":"Carlos Correa","3":"587","4":"497","5":"20.12305716","6":"0.0342811877","7":"3.42811877"},{"1":"677951","2":"Bobby Witt Jr.","3":"679","4":"605","5":"22.89693211","6":"0.0337215495","7":"3.37215495"},{"1":"664056","2":"Harrison Bader","3":"503","4":"436","5":"16.73060735","6":"0.0332616448","7":"3.32616448"},{"1":"810938","2":"Ben Williamson","3":"295","4":"263","5":"9.79656013","6":"0.0332086784","7":"3.32086784"},{"1":"670541","2":"Yordan Alvarez","3":"194","4":"162","5":"6.38945999","6":"0.0329353608","7":"3.29353608"},{"1":"571448","2":"Nolan Arenado","3":"433","4":"398","5":"14.24441191","6":"0.0328970252","7":"3.28970252"},{"1":"664770","2":"Nathan Lukes","3":"438","4":"376","5":"14.36513363","6":"0.0327971087","7":"3.27971087"},{"1":"642201","2":"Eli White","3":"271","4":"243","5":"8.78698814","6":"0.0324243105","7":"3.24243105"},{"1":"666969","2":"Adolis García","3":"548","4":"502","5":"17.57436990","6":"0.0320700181","7":"3.20700181"},{"1":"686797","2":"Brooks Lee","3":"528","4":"474","5":"16.82796973","6":"0.0318711548","7":"3.18711548"},{"1":"669242","2":"Tommy Edman","3":"377","4":"332","5":"12.00453587","6":"0.0318422702","7":"3.18422702"},{"1":"670224","2":"Kameron Misner","3":"217","4":"186","5":"6.85704621","6":"0.0315992913","7":"3.15992913"},{"1":"553993","2":"Eugenio Suárez","3":"658","4":"562","5":"20.78974882","6":"0.0315953630","7":"3.15953630"},{"1":"701538","2":"Jackson Merrill","3":"484","4":"432","5":"15.17829009","6":"0.0313601035","7":"3.13601035"},{"1":"609280","2":"Miguel Andujar","3":"340","4":"314","5":"10.48284498","6":"0.0308318970","7":"3.08318970"},{"1":"677594","2":"Julio Rodríguez","3":"704","4":"628","5":"21.61470895","6":"0.0307027116","7":"3.07027116"},{"1":"663624","2":"Ryan Mountcastle","3":"357","4":"323","5":"10.92708044","6":"0.0306080685","7":"3.06080685"},{"1":"669394","2":"Jake Burger","3":"377","4":"335","5":"11.47046221","6":"0.0304256292","7":"3.04256292"},{"1":"686527","2":"Dominic Canzone","3":"269","4":"230","5":"8.17016116","6":"0.0303723463","7":"3.03723463"},{"1":"680779","2":"Henry Davis","3":"283","4":"244","5":"8.45406007","6":"0.0298730038","7":"2.98730038"},{"1":"687401","2":"Joey Ortiz","3":"508","4":"451","5":"15.12252892","6":"0.0297687577","7":"2.97687577"},{"1":"676572","2":"Eric Wagaman","3":"514","4":"460","5":"15.27249307","6":"0.0297130215","7":"2.97130215"},{"1":"663647","2":"Ke'Bryan Hayes","3":"569","4":"490","5":"16.86010489","6":"0.0296311158","7":"2.96311158"},{"1":"663698","2":"Joey Bart","3":"334","4":"257","5":"9.86948899","6":"0.0295493682","7":"2.95493682"},{"1":"672744","2":"Alexander Canario","3":"234","4":"203","5":"6.88095720","6":"0.0294058000","7":"2.94058000"},{"1":"543309","2":"Kyle Higashioka","3":"327","4":"288","5":"9.60195050","6":"0.0293637630","7":"2.93637630"},{"1":"663586","2":"Austin Riley","3":"446","4":"397","5":"12.95456175","6":"0.0290461026","7":"2.90461026"},{"1":"682829","2":"Elly De La Cruz","3":"691","4":"568","5":"19.99584858","6":"0.0289375522","7":"2.89375522"},{"1":"690987","2":"Robert Hassell III","3":"207","4":"183","5":"5.96705645","6":"0.0288263597","7":"2.88263597"},{"1":"578428","2":"Jose Iglesias","3":"343","4":"294","5":"9.73594040","6":"0.0283846659","7":"2.83846659"},{"1":"621439","2":"Byron Buxton","3":"537","4":"468","5":"15.22040742","6":"0.0283434030","7":"2.83434030"},{"1":"696100","2":"Hunter Goodman","3":"579","4":"519","5":"16.39203132","6":"0.0283109349","7":"2.83109349"},{"1":"686668","2":"Brenton Doyle","3":"538","4":"467","5":"15.19389198","6":"0.0282414349","7":"2.82414349"},{"1":"663728","2":"Cal Raleigh","3":"689","4":"565","5":"19.19927072","6":"0.0278654147","7":"2.78654147"},{"1":"624431","2":"Jose Trevino","3":"302","4":"279","5":"8.34622443","6":"0.0276365048","7":"2.76365048"},{"1":"666182","2":"Bo Bichette","3":"628","4":"567","5":"17.23302325","6":"0.0274411198","7":"2.74411198"},{"1":"681351","2":"Logan O'Hoppe","3":"454","4":"398","5":"12.38782483","6":"0.0272859578","7":"2.72859578"},{"1":"650333","2":"Luis Arraez","3":"677","4":"637","5":"18.29944142","6":"0.0270301941","7":"2.70301941"},{"1":"669364","2":"Xavier Edwards","3":"618","4":"539","5":"16.61464753","6":"0.0268845429","7":"2.68845429"},{"1":"455117","2":"Martín Maldonado","3":"161","4":"142","5":"4.31023977","6":"0.0267716756","7":"2.67716756"},{"1":"669016","2":"Brandon Marsh","3":"426","4":"359","5":"11.27493613","6":"0.0264669862","7":"2.64669862"},{"1":"669720","2":"Austin Hays","3":"415","4":"365","5":"10.95492783","6":"0.0263974165","7":"2.63974165"},{"1":"691406","2":"Junior Caminero","3":"652","4":"589","5":"17.00045662","6":"0.0260743200","7":"2.60743200"},{"1":"596103","2":"Austin Slater","3":"160","4":"130","5":"4.14160621","6":"0.0258850388","7":"2.58850388"},{"1":"690022","2":"Ryan Ritter","3":"206","4":"176","5":"5.29531382","6":"0.0257054069","7":"2.57054069"},{"1":"686780","2":"Pedro Pagés","3":"388","4":"354","5":"9.86904440","6":"0.0254356814","7":"2.54356814"},{"1":"650859","2":"Luis Rengifo","3":"543","4":"478","5":"13.72205270","6":"0.0252708153","7":"2.52708153"},{"1":"672356","2":"Gabriel Arias","3":"470","4":"420","5":"11.86586531","6":"0.0252465219","7":"2.52465219"},{"1":"665161","2":"Jeremy Peña","3":"541","4":"477","5":"13.26163624","6":"0.0245131908","7":"2.45131908"},{"1":"643396","2":"Isiah Kiner-Falefa","3":"460","4":"411","5":"11.24157204","6":"0.0244382001","7":"2.44382001"},{"1":"664761","2":"Alec Bohm","3":"504","4":"439","5":"12.30850201","6":"0.0244216310","7":"2.44216310"},{"1":"676475","2":"Alec Burleson","3":"545","4":"490","5":"13.10480708","6":"0.0240455176","7":"2.40455176"},{"1":"665833","2":"Oneil Cruz","3":"541","4":"410","5":"12.83488080","6":"0.0237243638","7":"2.37243638"},{"1":"691781","2":"Brady House","3":"274","4":"249","5":"6.35722462","6":"0.0232015497","7":"2.32015497"},{"1":"681481","2":"Kerry Carpenter","3":"464","4":"425","5":"10.70114372","6":"0.0230628098","7":"2.30628098"},{"1":"694192","2":"Jackson Chourio","3":"589","4":"530","5":"13.43974134","6":"0.0228178970","7":"2.28178970"},{"1":"518595","2":"Travis d'Arnaud","3":"231","4":"195","5":"5.18588806","6":"0.0224497319","7":"2.24497319"},{"1":"682668","2":"Luisangel Acuña","3":"193","4":"169","5":"4.30951888","6":"0.0223291133","7":"2.23291133"},{"1":"671277","2":"Luis García Jr.","3":"527","4":"481","5":"11.61376198","6":"0.0220374990","7":"2.20374990"},{"1":"647304","2":"Josh Naylor","3":"601","4":"542","5":"13.14375802","6":"0.0218698137","7":"2.18698137"},{"1":"595978","2":"Austin Hedges","3":"180","4":"153","5":"3.87778504","6":"0.0215432502","7":"2.15432502"},{"1":"677008","2":"Heston Kjerstad","3":"167","4":"146","5":"3.44214292","6":"0.0206116342","7":"2.06116342"},{"1":"687263","2":"Zach Neto","3":"549","4":"483","5":"11.31061530","6":"0.0206022137","7":"2.06022137"},{"1":"682657","2":"Angel Martínez","3":"484","4":"437","5":"9.91882459","6":"0.0204934392","7":"2.04934392"},{"1":"679032","2":"Johan Rojas","3":"172","4":"148","5":"3.48603623","6":"0.0202676525","7":"2.02676525"},{"1":"691718","2":"Pete Crow-Armstrong","3":"646","4":"589","5":"13.03389230","6":"0.0201763039","7":"2.01763039"},{"1":"808975","2":"Hyeseong Kim","3":"170","4":"151","5":"3.36222215","6":"0.0197777774","7":"1.97777774"},{"1":"671732","2":"Lawrence Butler","3":"630","4":"522","5":"12.22085232","6":"0.0193981783","7":"1.93981783"},{"1":"669911","2":"Michael Toglia","3":"336","4":"281","5":"6.29133224","6":"0.0187242031","7":"1.87242031"},{"1":"700242","2":"Trey Sweeney","3":"326","4":"262","5":"6.02506697","6":"0.0184818005","7":"1.84818005"},{"1":"592206","2":"Nick Castellanos","3":"590","4":"524","5":"10.89006329","6":"0.0184577344","7":"1.84577344"},{"1":"682626","2":"Francisco Alvarez","3":"277","4":"233","5":"5.05456363","6":"0.0182475221","7":"1.82475221"},{"1":"642133","2":"Rowdy Tellez","3":"313","4":"272","5":"5.71027143","6":"0.0182436787","7":"1.82436787"},{"1":"678554","2":"Curtis Mead","3":"266","4":"220","5":"4.76520129","6":"0.0179142906","7":"1.79142906"},{"1":"673357","2":"Luis Robert Jr.","3":"428","4":"356","5":"7.52495246","6":"0.0175816646","7":"1.75816646"},{"1":"805779","2":"Jacob Wilson","3":"523","4":"478","5":"9.01724781","6":"0.0172413916","7":"1.72413916"},{"1":"663968","2":"Jake Mangum","3":"429","4":"391","5":"6.79483167","6":"0.0158387685","7":"1.58387685"},{"1":"660688","2":"Keibert Ruiz","3":"267","4":"253","5":"4.05779257","6":"0.0151977250","7":"1.51977250"},{"1":"695506","2":"Jac Caglianone","3":"232","4":"195","5":"3.40674197","6":"0.0146842326","7":"1.46842326"},{"1":"802415","2":"Chandler Simpson","3":"441","4":"410","5":"6.35906950","6":"0.0144196587","7":"1.44196587"},{"1":"666160","2":"Mickey Moniak","3":"460","4":"424","5":"6.63044981","6":"0.0144140213","7":"1.44140213"},{"1":"678662","2":"Ezequiel Tovar","3":"390","4":"363","5":"5.31187943","6":"0.0136202037","7":"1.36202037"},{"1":"668901","2":"Mark Vientos","3":"463","4":"408","5":"6.08628041","6":"0.0131453141","7":"1.31453141"},{"1":"682622","2":"Noelvi Marte","3":"361","4":"318","5":"4.64834498","6":"0.0128763019","7":"1.28763019"},{"1":"677950","2":"Alek Thomas","3":"470","4":"426","5":"5.97843240","6":"0.0127200689","7":"1.27200689"},{"1":"691777","2":"Max Muncy","3":"220","4":"194","5":"2.42173580","6":"0.0110078900","7":"1.10078900"},{"1":"676391","2":"Ernie Clement","3":"587","4":"548","5":"2.81527375","6":"0.0047960371","7":"0.47960371"},{"1":"691023","2":"Jordan Walker","3":"395","4":"325","5":"1.63326330","6":"0.0041348438","7":"0.41348438"},{"1":"642708","2":"Amed Rosario","3":"191","4":"173","5":"0.71694983","6":"0.0037536640","7":"0.37536640"},{"1":"521692","2":"Salvador Perez","3":"636","4":"589","5":"1.90625119","6":"0.0029972503","7":"0.29972503"},{"1":"514888","2":"Jose Altuve","3":"649","4":"575","5":"1.08963319","6":"0.0016789417","7":"0.16789417"},{"1":"672820","2":"Lenyn Sosa","3":"544","4":"505","5":"0.64845952","6":"0.0011920212","7":"0.11920212"},{"1":"682928","2":"CJ Abrams","3":"638","4":"560","5":"0.67350956","6":"0.0010556576","7":"0.10556576"},{"1":"672016","2":"Denzel Clarke","3":"159","4":"123","5":"-0.03371552","6":"-0.0002120473","7":"-0.02120473"},{"1":"695336","2":"Thomas Saggese","3":"294","4":"256","5":"-0.18136647","6":"-0.0006168928","7":"-0.06168928"},{"1":"671739","2":"Michael Harris II","3":"641","4":"612","5":"-1.82171590","6":"-0.0028419905","7":"-0.28419905"},{"1":"673962","2":"Josh Jung","3":"511","4":"450","5":"-1.58307199","6":"-0.0030979882","7":"-0.30979882"},{"1":"677595","2":"Ronny Mauricio","3":"183","4":"162","5":"-0.73548203","6":"-0.0040190275","7":"-0.40190275"},{"1":"665750","2":"Leody Taveras","3":"179","4":"161","5":"-0.92786150","6":"-0.0051835838","7":"-0.51835838"},{"1":"673237","2":"Yainer Diaz","3":"568","4":"534","5":"-4.94583686","6":"-0.0087074593","7":"-0.87074593"},{"1":"624641","2":"Edmundo Sosa","3":"261","4":"238","5":"-3.12904375","6":"-0.0119886734","7":"-1.19886734"},{"1":"650968","2":"Yohel Pozo","3":"168","4":"160","5":"-4.28062513","6":"-0.0254799115","7":"-2.54799115"},{"1":"595879","2":"Javier Báez","3":"437","4":"407","5":"-16.37519142","6":"-0.0374718339","7":"-3.74718339"},{"1":"678877","2":"Jhonkensy Noel","3":"153","4":"143","5":"-9.11348682","6":"-0.0595652733","7":"-5.95652733"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="sdv-leaderboard-plots" class="level1">
<h1>SDV Leaderboard Plots</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 15</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sdv_top <span class="ot">&lt;-</span> sdv_batter <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(dv_per_100_decisions, <span class="at">n =</span> <span class="dv">15</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sdv_top,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(batter_name, dv_per_100_decisions),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> dv_per_100_decisions)) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 15 Hitters by Swing Decision Value (2025 sample)"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Runs per 100 swing decisions"</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="swing_decision_modeling_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bottom 15</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sdv_bottom <span class="ot">&lt;-</span> sdv_batter <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(dv_per_100_decisions, <span class="at">n =</span> <span class="dv">15</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sdv_bottom,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(batter_name, dv_per_100_decisions),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> dv_per_100_decisions)) <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Bottom 15 Hitters by Swing Decision Value (2025 sample)"</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Runs per 100 swing decisions"</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="swing_decision_modeling_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sdv-decomposition-in-zone-vs-out-of-zone" class="level1">
<h1>SDV Decomposition: In-Zone vs Out-of-Zone</h1>
<section id="this-gives-a-zone-discipline-vs-chase-discipline-flavor-letting-you-say-things-like" class="level2">
<h2 class="anchored" data-anchor-id="this-gives-a-zone-discipline-vs-chase-discipline-flavor-letting-you-say-things-like">This gives a “zone discipline vs chase discipline” flavor, letting you say things like:</h2>
</section>
<section id="hitter-x-adds-the-most-value-by-not-chasing-out-of-zone-sdv." class="level2">
<h2 class="anchored" data-anchor-id="hitter-x-adds-the-most-value-by-not-chasing-out-of-zone-sdv.">Hitter X adds the most value by not chasing (out-of-zone SDV).”</h2>
</section>
<section id="hitter-y-is-great-at-attacking-in-zone-pitches-but-leaks-value-out-of-the-zone." class="level2">
<h2 class="anchored" data-anchor-id="hitter-y-is-great-at-attacking-in-zone-pitches-but-leaks-value-out-of-the-zone.">Hitter Y is great at attacking in-zone pitches but leaks value out of the zone.”</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sc_results_named <span class="ot">&lt;-</span> sc_results_named <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">in_zone =</span> <span class="fu">ifelse</span>(zone <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="st">"In-Zone"</span>, <span class="st">"Out-of-Zone"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>sdv_batter_zone <span class="ot">&lt;-</span> sc_results_named <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(batter, batter_name, in_zone) <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_pitches =</span> <span class="fu">n</span>(),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_swings  =</span> <span class="fu">sum</span>(is_swing),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_dv  =</span> <span class="fu">sum</span>(decision_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_dv   =</span> <span class="fu">mean</span>(decision_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">dv_per_100_decisions =</span> <span class="dv">100</span> <span class="sc">*</span> mean_dv,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_pitches <span class="sc">&gt;=</span> <span class="dv">10</span>)  <span class="co"># small per-bucket threshold</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>sdv_batter_zone <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dv_per_100_decisions)) <span class="sc">%&gt;%</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["batter"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["batter_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["in_zone"],"name":[3],"type":["chr"],"align":["left"]},{"label":["n_pitches"],"name":[4],"type":["int"],"align":["right"]},{"label":["n_swings"],"name":[5],"type":["int"],"align":["right"]},{"label":["total_dv"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["mean_dv"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["dv_per_100_decisions"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"660844","2":"Leo Rivas","3":"Out-of-Zone","4":"26","5":"6","6":"7.838987","7":"0.3014995","8":"30.14995"},{"1":"678391","2":"Jorbit Vivas","3":"Out-of-Zone","4":"15","5":"5","6":"2.928224","7":"0.1952149","8":"19.52149"},{"1":"687637","2":"Dylan Beavers","3":"Out-of-Zone","4":"49","5":"21","6":"9.332028","7":"0.1904496","8":"19.04496"},{"1":"669234","2":"Justyn-Henry Malloy","3":"Out-of-Zone","4":"41","5":"19","6":"7.610310","7":"0.1856173","8":"18.56173"},{"1":"571912","2":"Luke Maile","3":"Out-of-Zone","4":"17","5":"11","6":"2.957877","7":"0.1739927","8":"17.39927"},{"1":"665923","2":"Esteury Ruiz","3":"In-Zone","4":"17","5":"17","6":"2.911779","7":"0.1712811","8":"17.12811"},{"1":"805811","2":"Bryce Eldridge","3":"Out-of-Zone","4":"14","5":"6","6":"2.372177","7":"0.1694412","8":"16.94412"},{"1":"663656","2":"Kyle Tucker","3":"Out-of-Zone","4":"144","5":"66","6":"24.129787","7":"0.1675680","8":"16.75680"},{"1":"669398","2":"Gage Workman","3":"In-Zone","4":"12","5":"11","6":"1.999493","7":"0.1666244","8":"16.66244"},{"1":"676480","2":"José Barrero","3":"In-Zone","4":"19","5":"19","6":"3.157974","7":"0.1662092","8":"16.62092"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
</section>
<section id="neutral-decision-value-surface-league-average" class="level1">
<h1>Neutral Decision Value Surface (league-average)</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>make_sim_grid <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">pitch_type =</span> <span class="st">"FF"</span>) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">plate_x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="at">length.out =</span> <span class="dv">40</span>),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">plate_z =</span> <span class="fu">seq</span>(<span class="fl">1.0</span>, <span class="fl">4.0</span>, <span class="at">length.out =</span> <span class="dv">40</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">zone              =</span> <span class="cn">NA_real_</span>,   <span class="co"># let model infer via location</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">release_speed     =</span> <span class="dv">94</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">pfx_x             =</span> <span class="dv">0</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">pfx_z             =</span> <span class="dv">10</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">release_extension =</span> <span class="fl">6.0</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">balls             =</span> <span class="dv">0</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">strikes           =</span> <span class="dv">0</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">outs_when_up      =</span> <span class="dv">0</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">inning            =</span> <span class="dv">1</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">home_score_diff   =</span> <span class="dv">0</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">bat_score_diff    =</span> <span class="dv">0</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">stand             =</span> <span class="st">"R"</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_throws          =</span> <span class="st">"R"</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">pitch_type        =</span> pitch_type,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">base_state        =</span> <span class="st">"000"</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">count_str         =</span> <span class="st">"0-0"</span>,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">state_id          =</span> <span class="fu">paste</span>(base_state, outs_when_up, count_str, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Build neutral grid</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>sim_grid <span class="ot">&lt;-</span> <span class="fu">make_sim_grid</span>(<span class="st">"FF"</span>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Match numeric preprocessing from model_df</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>sim_grid <span class="ot">&lt;-</span> sim_grid <span class="sc">%&gt;%</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">all_of</span>(num_vars), as.numeric)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Handle categoricals and force same factor levels as in training</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co">#    - replace NA with "UNK"</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="co">#    - use levels from model_df so sparse.model.matrix sees full factor space</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>sim_grid <span class="ot">&lt;-</span> sim_grid <span class="sc">%&gt;%</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">all_of</span>(cat_vars), <span class="sc">~</span><span class="fu">replace_na</span>(<span class="fu">as.character</span>(.x), <span class="st">"UNK"</span>))</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> cat_vars) {</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  sim_grid[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(sim_grid[[v]],</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(model_df[[v]])))</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Build design matrices using the SAME dummy_formula as training</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>X_sim_num <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(sim_grid[, num_vars])</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>X_sim_cat <span class="ot">&lt;-</span> <span class="fu">sparse.model.matrix</span>(dummy_formula, <span class="at">data =</span> sim_grid)</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>X_sim <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_sim_num, X_sim_cat)</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Get ERV(swing) and ERV(take) for the grid</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>erv_sim <span class="ot">&lt;-</span> <span class="fu">predict_erv_decision</span>(X_sim, sim_grid<span class="sc">$</span>state_id)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>sim_grid <span class="ot">&lt;-</span> sim_grid <span class="sc">%&gt;%</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(erv_sim) <span class="sc">%&gt;%</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decision_value =</span> erv_swing <span class="sc">-</span> erv_take)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_grid, <span class="fu">aes</span>(<span class="at">x =</span> plate_x, <span class="at">y =</span> plate_z, <span class="at">fill =</span> decision_value)) <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"ERV(swing) - ERV(take)"</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rect"</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">0.83</span>, <span class="at">xmax =</span> <span class="fl">0.83</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="fl">1.5</span>,  <span class="at">ymax =</span> <span class="fl">3.5</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Neutral Decision Value Surface (R vs R, FF, 0-0, bases empty)"</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Plate X (ft, catcher view)"</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Plate Z (ft)"</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="swing_decision_modeling_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation" class="level1">
<h1>Interpretation</h1>
<p>This surface shows the neutral swing decision landscape for a representative RHP vs RHB four-seam fastball in a 0–0 count with bases empty. The colors represent ERV(swing) – ERV(take) at each location in the strike zone, where negative values mean the model believes a take is (on average) the better run-value decision, while positive values would favor a swing. Interestingly, the entire map is shaded slightly negative, including most of the strike zone. That might look counterintuitive at first, but it actually reflects the underlying run-value baseline: in an average, league-wide 0–0 count, taking a pitch is usually a slightly better expected-value outcome than swinging, unless the pitch is in a particularly damage-prone location. Swings only produce sizable positive RV on a small subset of outcomes (solid contact), whereas takes avoid most of the negative RV from weak contact or whiffs. Because the map here is neutralized across all hitters and pitchers, it’s intentionally “flat” — showing that, on average, hitters don’t gain RV by swinging at random zone locations, and that the positive-value swing regions for specific hitters emerge only when we condition on their profiles later.</p>
</section>
<section id="same-plot-but-for-0-2-counts" class="level1">
<h1>Same plot but for 0-2 counts</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build neutral grid for 0-2</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>sim_grid_02 <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">plate_x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="at">length.out =</span> <span class="dv">40</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">plate_z =</span> <span class="fu">seq</span>(<span class="fl">1.0</span>, <span class="fl">4.0</span>, <span class="at">length.out =</span> <span class="dv">40</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">zone              =</span> <span class="cn">NA_real_</span>,   <span class="co"># let model infer via location</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">release_speed     =</span> <span class="dv">94</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pfx_x             =</span> <span class="dv">0</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pfx_z             =</span> <span class="dv">10</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">release_extension =</span> <span class="fl">6.0</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">balls             =</span> <span class="dv">0</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">strikes           =</span> <span class="dv">2</span>,          <span class="co"># &lt;-- 0-2 count</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">outs_when_up      =</span> <span class="dv">0</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">inning            =</span> <span class="dv">1</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">home_score_diff   =</span> <span class="dv">0</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">bat_score_diff    =</span> <span class="dv">0</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">stand             =</span> <span class="st">"R"</span>,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_throws          =</span> <span class="st">"R"</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">pitch_type        =</span> <span class="st">"FF"</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_state        =</span> <span class="st">"000"</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">count_str         =</span> <span class="st">"0-2"</span>,      <span class="co"># &lt;-- 0-2 label</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_id          =</span> <span class="fu">paste</span>(base_state, outs_when_up, count_str, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Match numeric preprocessing from model_df</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>sim_grid_02 <span class="ot">&lt;-</span> sim_grid_02 <span class="sc">%&gt;%</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">all_of</span>(num_vars), as.numeric)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle categoricals and force same factor levels as in training</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>sim_grid_02 <span class="ot">&lt;-</span> sim_grid_02 <span class="sc">%&gt;%</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">all_of</span>(cat_vars), <span class="sc">~</span><span class="fu">replace_na</span>(<span class="fu">as.character</span>(.x), <span class="st">"UNK"</span>))</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> cat_vars) {</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  sim_grid_02[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    sim_grid_02[[v]],</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(model_df[[v]]))</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Build design matrices using the SAME dummy_formula as training</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>X_sim_num_02 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(sim_grid_02[, num_vars])</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>X_sim_cat_02 <span class="ot">&lt;-</span> <span class="fu">sparse.model.matrix</span>(dummy_formula, <span class="at">data =</span> sim_grid_02)</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>X_sim_02 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_sim_num_02, X_sim_cat_02)</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Get ERV(swing) and ERV(take) for the 0-2 grid</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>erv_sim_02 <span class="ot">&lt;-</span> <span class="fu">predict_erv_decision</span>(X_sim_02, sim_grid_02<span class="sc">$</span>state_id)</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>sim_grid_02 <span class="ot">&lt;-</span> sim_grid_02 <span class="sc">%&gt;%</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(erv_sim_02) <span class="sc">%&gt;%</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decision_value =</span> erv_swing <span class="sc">-</span> erv_take)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_grid_02, <span class="fu">aes</span>(<span class="at">x =</span> plate_x, <span class="at">y =</span> plate_z, <span class="at">fill =</span> decision_value)) <span class="sc">+</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"ERV(swing) - ERV(take)"</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rect"</span>,</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">0.83</span>, <span class="at">xmax =</span> <span class="fl">0.83</span>,</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="fl">1.5</span>,  <span class="at">ymax =</span> <span class="fl">3.5</span>,</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Neutral Decision Value Surface (R vs R, FF, 0-2, bases empty)"</span>,</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Plate X (ft, catcher view)"</span>,</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Plate Z (ft)"</span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="swing_decision_modeling_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation-1" class="level1">
<h1>Interpretation</h1>
<p>This plot now shows the neutral swing decision surface for a RHP vs RHB four-seam fastball in a 0–2 count, with bases empty. Unlike the 0–0 landscape, this one flips dramatically: the entire strike zone, as well as a border surrounding the entire zone, now shows positive ERV(swing) – ERV(take). This of course makes intuitive sense. The model learned that hitters should generally be in protect mode on 0–2, expanding their swing decisions throughout the zone and even a bit beyond it. This contrast with the 0–0 plot shows that my model is capturing realistic baseball behavior driven by run-value consequences rather than simply location-based heuristics. The plot makes me even more confident in my model.</p>
</section>
<section id="another-couple-diagnostics" class="level1">
<h1>Another couple diagnostics</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>diag_df <span class="ot">&lt;-</span> sc_results_named <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">erv_decision_hat =</span> <span class="fu">ifelse</span>(is_swing <span class="sc">==</span> <span class="dv">1</span>L, erv_swing_hat, erv_take_hat)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>diag_df <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_actual_rv =</span> <span class="fu">mean</span>(rv, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_pred_erv  =</span> <span class="fu">mean</span>(erv_decision_hat, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mean_actual_rv"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["mean_pred_erv"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.008060729","2":"0.007323892"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>They’re extremely close, showing that my model behaves quite reasonably.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>diag_by_count <span class="ot">&lt;-</span> sc_results_named <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">count_str =</span> <span class="fu">paste0</span>(balls, <span class="st">"-"</span>, strikes),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">erv_decision_hat =</span> <span class="fu">ifelse</span>(is_swing <span class="sc">==</span> <span class="dv">1</span>L, erv_swing_hat, erv_take_hat)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(count_str) <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n          =</span> <span class="fu">n</span>(),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_actual_rv =</span> <span class="fu">mean</span>(rv, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_pred_erv  =</span> <span class="fu">mean</span>(erv_decision_hat, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>diag_by_count <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["count_str"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]},{"label":["mean_actual_rv"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["mean_pred_erv"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"1-2","2":"27594","3":"-0.0380512793","4":"-0.0349948086"},{"1":"2-2","2":"26381","3":"-0.0666551685","4":"-0.0645911924"},{"1":"3-2","2":"25727","3":"-0.0004012516","4":"-0.0002294284"},{"1":"0-0","2":"21588","3":"0.0615988049","4":"0.0585280832"},{"1":"0-2","2":"16826","3":"-0.0243075597","4":"-0.0203460529"},{"1":"0-1","2":"16424","3":"0.0715133341","4":"0.0744214995"},{"1":"1-1","2":"14569","3":"0.0582598668","4":"0.0544661389"},{"1":"1-0","2":"11117","3":"0.0276750922","4":"0.0206024164"},{"1":"2-1","2":"8405","3":"0.0178273647","4":"0.0127736045"},{"1":"3-1","2":"7451","3":"0.0870814656","4":"0.0786807478"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Better yet, my model is extremely well-calibrated across all possible counts.</p>
</section>
<section id="cj-abrams-decision-value-surfaces-by-count-faceted" class="level1">
<h1>CJ Abrams: Decision Value Surfaces by Count (faceted)</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find CJ Abrams' batter ID</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>abrams_row <span class="ot">&lt;-</span> sdv_batter <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(batter_name, <span class="fu">regex</span>(<span class="st">"Abrams"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>abrams_id   <span class="ot">&lt;-</span> abrams_row<span class="sc">$</span>batter</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>abrams_name <span class="ot">&lt;-</span> abrams_row<span class="sc">$</span>batter_name</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>abrams_id</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 682928</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>abrams_name</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CJ Abrams"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All pitches for Abrams</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>abrams_pitches <span class="ot">&lt;-</span> sc_results_named <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(batter <span class="sc">==</span> abrams_id)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># draw Abrams contexts for a given count</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>draw_context_count <span class="ot">&lt;-</span> <span class="cf">function</span>(b, s, n) {</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  ctx <span class="ot">&lt;-</span> abrams_pitches <span class="sc">%&gt;%</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(balls <span class="sc">==</span> b, strikes <span class="sc">==</span> s)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(ctx) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  ctx <span class="sc">%&gt;%</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">setdiff</span>(model_vars, <span class="fu">c</span>(<span class="st">"plate_x"</span>, <span class="st">"plate_z"</span>))), state_id)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>counts_to_plot <span class="ot">&lt;-</span> abrams_pitches <span class="sc">%&gt;%</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(balls, strikes, <span class="at">name =</span> <span class="st">"n_pitches"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(balls, strikes)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Build decision surfaces for each count via Monte Carlo</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># grid resolution and MC reps per grid cell</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>px_seq  <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="at">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>pz_seq  <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">1.0</span>, <span class="fl">4.0</span>, <span class="at">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>n_mc    <span class="ot">&lt;-</span> <span class="dv">80</span>   <span class="co"># increase for smoother surfaces, decrease for speed</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>abrams_count_surfaces <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seq_len</span>(<span class="fu">nrow</span>(counts_to_plot)),</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(i) {</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">&lt;-</span> counts_to_plot<span class="sc">$</span>balls[i]</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> counts_to_plot<span class="sc">$</span>strikes[i]</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    n_here <span class="ot">&lt;-</span> counts_to_plot<span class="sc">$</span>n_pitches[i]</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grid for this count</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    grid_cs <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">plate_x =</span> px_seq,</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">plate_z =</span> pz_seq</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">balls   =</span> b,</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">strikes =</span> s,</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">count_str =</span> <span class="fu">paste0</span>(balls, <span class="st">"-"</span>, strikes)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each grid point, Monte Carlo over Abrams' contexts at this count</span></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    res_cs <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(grid_cs)), <span class="cf">function</span>(j) {</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>      px <span class="ot">&lt;-</span> grid_cs<span class="sc">$</span>plate_x[j]</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>      pz <span class="ot">&lt;-</span> grid_cs<span class="sc">$</span>plate_z[j]</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>      ctx <span class="ot">&lt;-</span> <span class="fu">draw_context_count</span>(b, s, n_mc)</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(ctx)) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>      ctx <span class="ot">&lt;-</span> ctx <span class="sc">%&gt;%</span></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">plate_x =</span> px,</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>          <span class="at">plate_z =</span> pz</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Preprocess to match model_df</span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>      ctx <span class="ot">&lt;-</span> ctx <span class="sc">%&gt;%</span></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>          <span class="fu">across</span>(<span class="fu">all_of</span>(num_vars), as.numeric),</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>          <span class="fu">across</span>(<span class="fu">all_of</span>(cat_vars), <span class="sc">~</span><span class="fu">replace_na</span>(<span class="fu">as.character</span>(.x), <span class="st">"UNK"</span>))</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (v <span class="cf">in</span> cat_vars) {</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>        ctx[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>          ctx[[v]],</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>          <span class="at">levels =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(model_df[[v]]))</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>      X_num_ctx <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(ctx[, num_vars])</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>      X_cat_ctx <span class="ot">&lt;-</span> <span class="fu">sparse.model.matrix</span>(dummy_formula, <span class="at">data =</span> ctx)</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>      X_ctx     <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_num_ctx, X_cat_ctx)</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>      erv_ctx <span class="ot">&lt;-</span> <span class="fu">predict_erv_decision</span>(X_ctx, ctx<span class="sc">$</span>state_id)</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>        <span class="at">plate_x =</span> px,</span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">plate_z =</span> pz,</span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>        <span class="at">balls   =</span> b,</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>        <span class="at">strikes =</span> s,</span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">count_str =</span> <span class="fu">paste0</span>(b, <span class="st">"-"</span>, s),</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">decision_value =</span> <span class="fu">mean</span>(erv_ctx<span class="sc">$</span>erv_swing <span class="sc">-</span> erv_ctx<span class="sc">$</span>erv_take)</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>    res_cs</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop any counts that had no usable context</span></span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>abrams_count_surfaces <span class="ot">&lt;-</span> abrams_count_surfaces <span class="sc">%&gt;%</span></span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(decision_value))</span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Symmetric color limits across all counts</span></span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a>max_abs_dv <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(abrams_count_surfaces<span class="sc">$</span>decision_value), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot faceted decision surfaces by count</span></span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(abrams_count_surfaces,</span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> plate_x, <span class="at">y =</span> plate_z, <span class="at">fill =</span> decision_value)) <span class="sc">+</span></span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">low  =</span> <span class="st">"#2166ac"</span>,   <span class="co"># strong blue for take-favored</span></span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid  =</span> <span class="st">"white"</span>,</span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"#b2182b"</span>,   <span class="co"># strong red for swing-favored</span></span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>max_abs_dv, max_abs_dv),</span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"ERV(swing) - ERV(take)"</span></span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rect"</span>,</span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">0.83</span>, <span class="at">xmax =</span> <span class="fl">0.83</span>,</span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="fl">1.5</span>,  <span class="at">ymax =</span> <span class="fl">3.5</span>,</span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span></span>
<span id="cb21-120"><a href="#cb21-120" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-121"><a href="#cb21-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> count_str) <span class="sc">+</span></span>
<span id="cb21-122"><a href="#cb21-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-123"><a href="#cb21-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"CJ Abrams Decision Value Surfaces by Count"</span>,</span>
<span id="cb21-124"><a href="#cb21-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"ERV(swing) - ERV(take), Monte Carlo over Abrams' own contexts"</span>,</span>
<span id="cb21-125"><a href="#cb21-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Plate X (ft, catcher view)"</span>,</span>
<span id="cb21-126"><a href="#cb21-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Plate Z (ft)"</span></span>
<span id="cb21-127"><a href="#cb21-127" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-128"><a href="#cb21-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="swing_decision_modeling_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>This project builds a fully operational, pitch-by-pitch swing–take decision model grounded in Expected Run Value (ERV). By separating swing and take outcomes, modeling their probabilities independently, and recombining them into a unified decision value framework, we can evaluate not only what happened on a pitch, but what should have happened. The analytics pipeline successfully maps decision value across the strike zone, by count, pitch type, and even for individual hitters, demonstrating that the model captures real-world baseball logic (e.g., protect mode on two strikes, auto-take counts, and the shifting value of aggression). From a practical MLB perspective, this provides a quantitative lens for coaching swing decisions, comparing hitters’ judgment ability, identifying zones where players are leaving value on the table, and optimizing approach plans. While this version is already valuable, future enhancements such as hitter- and pitcher-specific models, improved xwOBA-based outcome modeling, smoother Monte Carlo surfaces, and integrating pitch intent would sharpen the system further and push it toward front-office grade decision-tooling.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Batter Swing Decision Model (ERV &amp; SDV), R"</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Charlie Wiebe"</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2025-10-31</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [Batting, Machine Learning, R] </span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document:</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_depth: 3</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc_float: true</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code_folding: hide</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number_sections: true</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="an">fontsize:</span><span class="co"> 12pt</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="an">geometry:</span><span class="co"> margin=1in</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="fu"># Swing Decision Value (SDV) Modeling</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="fu">### Swing decisions sit at the center of modern hitting analytics: every pitch presents a choice, and the value of swinging versus taking varies dramatically with location, count, pitch type, and game context. For this project, I built a full Expected Run Value (ERV)–based swing decision model that quantifies this choice on every pitch of the 2025 season. By modeling swing and take outcomes separately using XGBoost, estimating their run-value consequences across thousands of game states, and combining them into a unified “decision value,” the framework produces intuitive zone maps, batter-specific profiles, and actionable insights. This gives us a scalable, data-driven way to evaluate decision quality—moving beyond results to measure the underlying process that defines elite hitters.</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="fu"># Set Up</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix) <span class="co"># For XGBoost</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>statcast_2025 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"statcast_2025.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>DT <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(statcast_2025)</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>batter_name_from_des <span class="ot">&lt;-</span> statcast_2025 <span class="sc">%&gt;%</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(des)) <span class="sc">%&gt;%</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract batter name before common verbs: "grounds", "singles", etc.</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">batter_name_guess =</span> <span class="fu">str_extract</span>(</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>      des,</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>      <span class="st">"^[^,]+?(?= grounds| singles| homers| lines| flies| strikes| walks| hits| bunts| pops| reaches)"</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(batter_name_guess)) <span class="sc">%&gt;%</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(batter) <span class="sc">%&gt;%</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_rows  =</span> <span class="fu">n</span>(),</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_names =</span> <span class="fu">n_distinct</span>(batter_name_guess),</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">batter_name =</span> <span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">table</span>(batter_name_guess), <span class="at">decreasing =</span> <span class="cn">TRUE</span>))[<span class="dv">1</span>],</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a><span class="fu"># Cleaning &amp; defining swings vs takes</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> statcast_2025 <span class="sc">%&gt;%</span></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(game_year <span class="sc">==</span> <span class="dv">2025</span>,</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>         game_type <span class="sc">==</span> <span class="st">"R"</span>, <span class="co"># Only regular season</span></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"bunt"</span>, description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>         events <span class="sc">!=</span> <span class="st">"intent_walk"</span>)</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>swing_descriptions <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>  <span class="st">"swinging_strike"</span>, <span class="st">"foul"</span>, <span class="st">"hit_into_play"</span>, <span class="st">"swinging_strike_blocked"</span>,</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>  <span class="st">"foul_tip"</span>, <span class="st">"foul_bunt"</span>, <span class="st">"missed_bunt"</span></span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> sc <span class="sc">%&gt;%</span></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">description_clean =</span> <span class="fu">tolower</span>(description),</span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_swing =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"X"</span> <span class="sc">~</span> <span class="dv">1</span>L, <span class="co"># ball in play</span></span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(description_clean, <span class="fu">paste</span>(swing_descriptions, <span class="at">collapse =</span> <span class="st">"|"</span>)) <span class="sc">~</span> <span class="dv">1</span>L,</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>L</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a><span class="fu"># Run value framework (ERV)</span></span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> sc <span class="sc">%&gt;%</span></span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rv =</span> delta_run_exp)</span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> sc <span class="sc">%&gt;%</span></span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">event_cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"single"</span>) <span class="sc">~</span> <span class="st">"1B"</span>,</span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"double"</span>) <span class="sc">~</span> <span class="st">"2B"</span>,</span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"triple"</span>) <span class="sc">~</span> <span class="st">"3B"</span>,</span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"home_run"</span>) <span class="sc">~</span> <span class="st">"HR"</span>,</span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"walk"</span>, <span class="st">"hit_by_pitch"</span>, <span class="st">"intent_walk"</span>) <span class="sc">~</span> <span class="st">"BB_HBP"</span>,</span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"strikeout"</span>) <span class="sc">&amp;</span></span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(description_clean, <span class="st">"swinging"</span>) <span class="sc">~</span> <span class="st">"K_swing"</span>,</span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>      events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"strikeout"</span>) <span class="sc">&amp;</span></span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(description_clean, <span class="st">"called"</span>) <span class="sc">~</span> <span class="st">"K_look"</span>,</span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"B"</span> <span class="sc">~</span> <span class="st">"ball"</span>,</span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"S"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(description_clean, <span class="st">"called_strike"</span>) <span class="sc">~</span> <span class="st">"called_strike"</span>,</span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"S"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(description_clean, <span class="st">"foul"</span>) <span class="sc">~</span> <span class="st">"foul"</span>,</span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"S"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(description_clean, <span class="st">"swinging"</span>) <span class="sc">~</span> <span class="st">"swing_miss"</span>,</span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"X"</span> <span class="sc">&amp;</span> events <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"field_error"</span>) <span class="sc">~</span> <span class="st">"reach_error"</span>,</span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"X"</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(events) <span class="sc">~</span> <span class="st">"inplay_out"</span>, <span class="co"># misc outs</span></span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"other"</span></span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity check</span></span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(sc<span class="sc">$</span>event_cat)</span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a>sc <span class="ot">&lt;-</span> sc <span class="sc">%&gt;%</span></span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_state =</span> <span class="fu">paste0</span>(</span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(on_1b), <span class="st">"1"</span>, <span class="st">"0"</span>),</span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(on_2b), <span class="st">"1"</span>, <span class="st">"0"</span>),</span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(on_3b), <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">count_str =</span> <span class="fu">paste0</span>(balls, <span class="st">"-"</span>, strikes),</span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_id  =</span> <span class="fu">paste</span>(base_state, outs_when_up, count_str, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a><span class="fu"># Two-model setup: swing (ERV) and take (ERV)</span></span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Some core features I want in my model</span></span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a>model_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a>  <span class="st">"plate_x"</span>, <span class="st">"plate_z"</span>, <span class="st">"zone"</span>,</span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a>  <span class="st">"release_speed"</span>, <span class="st">"pfx_x"</span>, <span class="st">"pfx_z"</span>, <span class="st">"release_extension"</span>,</span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a>  <span class="st">"balls"</span>, <span class="st">"strikes"</span>, <span class="st">"outs_when_up"</span>,</span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a>  <span class="st">"inning"</span>, <span class="st">"home_score_diff"</span>, <span class="st">"bat_score_diff"</span>,</span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a>  <span class="st">"stand"</span>, <span class="st">"p_throws"</span>, <span class="st">"pitch_type"</span></span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a>model_df <span class="ot">&lt;-</span> sc <span class="sc">%&gt;%</span></span>
<span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(event_cat), <span class="sc">!</span><span class="fu">is.na</span>(rv)) <span class="sc">%&gt;%</span></span>
<span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(model_vars), event_cat, is_swing, state_id)</span>
<span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a><span class="do">## Convert to numeric matrix for xgboost (one-hot encode categoricals):</span></span>
<span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a>dummy_formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(</span>
<span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"~"</span>, <span class="fu">paste</span>(<span class="fu">setdiff</span>(model_vars, <span class="fu">c</span>(<span class="st">"plate_x"</span>, <span class="st">"plate_z"</span>, <span class="st">"release_speed"</span>,</span>
<span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"pfx_x"</span>, <span class="st">"pfx_z"</span>, <span class="st">"release_extension"</span>,</span>
<span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"balls"</span>, <span class="st">"strikes"</span>, <span class="st">"outs_when_up"</span>,</span>
<span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"inning"</span>, <span class="st">"home_score_diff"</span>, <span class="st">"bat_score_diff"</span>)),</span>
<span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a>                   <span class="at">collapse =</span> <span class="st">"+"</span>))</span>
<span id="cb22-147"><a href="#cb22-147" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-148"><a href="#cb22-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-149"><a href="#cb22-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Define numeric &amp; categorical vars explicitly</span></span>
<span id="cb22-150"><a href="#cb22-150" aria-hidden="true" tabindex="-1"></a>num_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb22-151"><a href="#cb22-151" aria-hidden="true" tabindex="-1"></a>  <span class="st">"plate_x"</span>, <span class="st">"plate_z"</span>, <span class="st">"release_speed"</span>, <span class="st">"pfx_x"</span>, <span class="st">"pfx_z"</span>,</span>
<span id="cb22-152"><a href="#cb22-152" aria-hidden="true" tabindex="-1"></a>  <span class="st">"release_extension"</span>, <span class="st">"balls"</span>, <span class="st">"strikes"</span>, <span class="st">"outs_when_up"</span>,</span>
<span id="cb22-153"><a href="#cb22-153" aria-hidden="true" tabindex="-1"></a>  <span class="st">"inning"</span>, <span class="st">"home_score_diff"</span>, <span class="st">"bat_score_diff"</span>, <span class="st">"zone"</span></span>
<span id="cb22-154"><a href="#cb22-154" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-155"><a href="#cb22-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-156"><a href="#cb22-156" aria-hidden="true" tabindex="-1"></a>cat_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(model_vars, num_vars)  <span class="co"># stand", "p_throws", "pitch_type"</span></span>
<span id="cb22-157"><a href="#cb22-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-158"><a href="#cb22-158" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure no NA in categorical columns</span></span>
<span id="cb22-159"><a href="#cb22-159" aria-hidden="true" tabindex="-1"></a>model_df <span class="ot">&lt;-</span> model_df <span class="sc">%&gt;%</span></span>
<span id="cb22-160"><a href="#cb22-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(cat_vars), <span class="sc">~</span><span class="fu">replace_na</span>(.x, <span class="st">"UNK"</span>)))</span>
<span id="cb22-161"><a href="#cb22-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-162"><a href="#cb22-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Rebuild dummy formula only from the categorical vars</span></span>
<span id="cb22-163"><a href="#cb22-163" aria-hidden="true" tabindex="-1"></a>dummy_formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(</span>
<span id="cb22-164"><a href="#cb22-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"~"</span>, <span class="fu">paste</span>(cat_vars, <span class="at">collapse =</span> <span class="st">" + "</span>), <span class="st">"- 1"</span>)</span>
<span id="cb22-165"><a href="#cb22-165" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-166"><a href="#cb22-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-167"><a href="#cb22-167" aria-hidden="true" tabindex="-1"></a><span class="co"># Numeric matrix</span></span>
<span id="cb22-168"><a href="#cb22-168" aria-hidden="true" tabindex="-1"></a>X_num <span class="ot">&lt;-</span> model_df <span class="sc">%&gt;%</span></span>
<span id="cb22-169"><a href="#cb22-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(num_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb22-170"><a href="#cb22-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb22-171"><a href="#cb22-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-172"><a href="#cb22-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Categorical one-hot sparse matrix</span></span>
<span id="cb22-173"><a href="#cb22-173" aria-hidden="true" tabindex="-1"></a>X_cat <span class="ot">&lt;-</span> <span class="fu">sparse.model.matrix</span>(dummy_formula, <span class="at">data =</span> model_df)</span>
<span id="cb22-174"><a href="#cb22-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-175"><a href="#cb22-175" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity check</span></span>
<span id="cb22-176"><a href="#cb22-176" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(model_df); <span class="fu">nrow</span>(X_num); <span class="fu">nrow</span>(X_cat)</span>
<span id="cb22-177"><a href="#cb22-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-178"><a href="#cb22-178" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">nrow</span>(X_num) <span class="sc">==</span> <span class="fu">nrow</span>(X_cat))</span>
<span id="cb22-179"><a href="#cb22-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-180"><a href="#cb22-180" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine</span></span>
<span id="cb22-181"><a href="#cb22-181" aria-hidden="true" tabindex="-1"></a>X_full <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_num, X_cat)</span>
<span id="cb22-182"><a href="#cb22-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-183"><a href="#cb22-183" aria-hidden="true" tabindex="-1"></a><span class="do">## Build the two training sets</span></span>
<span id="cb22-184"><a href="#cb22-184" aria-hidden="true" tabindex="-1"></a>swing_idx <span class="ot">&lt;-</span> <span class="fu">which</span>(model_df<span class="sc">$</span>is_swing <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb22-185"><a href="#cb22-185" aria-hidden="true" tabindex="-1"></a>take_idx  <span class="ot">&lt;-</span> <span class="fu">which</span>(model_df<span class="sc">$</span>is_swing <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb22-186"><a href="#cb22-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-187"><a href="#cb22-187" aria-hidden="true" tabindex="-1"></a><span class="co"># Map event_cat to integer class labels</span></span>
<span id="cb22-188"><a href="#cb22-188" aria-hidden="true" tabindex="-1"></a>event_levels <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(model_df<span class="sc">$</span>event_cat))</span>
<span id="cb22-189"><a href="#cb22-189" aria-hidden="true" tabindex="-1"></a>model_df<span class="sc">$</span>event_id <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(model_df<span class="sc">$</span>event_cat, <span class="at">levels =</span> event_levels)) <span class="sc">-</span> <span class="dv">1</span>L</span>
<span id="cb22-190"><a href="#cb22-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-191"><a href="#cb22-191" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset sc to rows we're modeling (same filters as model_df)</span></span>
<span id="cb22-192"><a href="#cb22-192" aria-hidden="true" tabindex="-1"></a>sc_model <span class="ot">&lt;-</span> sc <span class="sc">%&gt;%</span></span>
<span id="cb22-193"><a href="#cb22-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(event_cat), <span class="sc">!</span><span class="fu">is.na</span>(rv))</span>
<span id="cb22-194"><a href="#cb22-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-195"><a href="#cb22-195" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity check: model_df and sc_model should align row-wise</span></span>
<span id="cb22-196"><a href="#cb22-196" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">nrow</span>(sc_model) <span class="sc">==</span> <span class="fu">nrow</span>(model_df))</span>
<span id="cb22-197"><a href="#cb22-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-198"><a href="#cb22-198" aria-hidden="true" tabindex="-1"></a><span class="co"># RV lookup by (event_cat, state_id)</span></span>
<span id="cb22-199"><a href="#cb22-199" aria-hidden="true" tabindex="-1"></a>rv_lookup <span class="ot">&lt;-</span> sc_model <span class="sc">%&gt;%</span></span>
<span id="cb22-200"><a href="#cb22-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(event_cat, state_id) <span class="sc">%&gt;%</span></span>
<span id="cb22-201"><a href="#cb22-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb22-202"><a href="#cb22-202" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_rv =</span> <span class="fu">mean</span>(rv, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-203"><a href="#cb22-203" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb22-204"><a href="#cb22-204" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb22-205"><a href="#cb22-205" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-206"><a href="#cb22-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-207"><a href="#cb22-207" aria-hidden="true" tabindex="-1"></a><span class="co"># Global fallback RV by event only (for states with few/no obs)</span></span>
<span id="cb22-208"><a href="#cb22-208" aria-hidden="true" tabindex="-1"></a>rv_global <span class="ot">&lt;-</span> sc_model <span class="sc">%&gt;%</span></span>
<span id="cb22-209"><a href="#cb22-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(event_cat) <span class="sc">%&gt;%</span></span>
<span id="cb22-210"><a href="#cb22-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb22-211"><a href="#cb22-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_rv_global =</span> <span class="fu">mean</span>(rv, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-212"><a href="#cb22-212" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb22-213"><a href="#cb22-213" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-214"><a href="#cb22-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-215"><a href="#cb22-215" aria-hidden="true" tabindex="-1"></a>dtrain_swing <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(</span>
<span id="cb22-216"><a href="#cb22-216" aria-hidden="true" tabindex="-1"></a>  <span class="at">data  =</span> X_full[swing_idx, ],</span>
<span id="cb22-217"><a href="#cb22-217" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> model_df<span class="sc">$</span>event_id[swing_idx]</span>
<span id="cb22-218"><a href="#cb22-218" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-219"><a href="#cb22-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-220"><a href="#cb22-220" aria-hidden="true" tabindex="-1"></a>dtrain_take <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(</span>
<span id="cb22-221"><a href="#cb22-221" aria-hidden="true" tabindex="-1"></a>  <span class="at">data  =</span> X_full[take_idx, ],</span>
<span id="cb22-222"><a href="#cb22-222" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> model_df<span class="sc">$</span>event_id[take_idx]</span>
<span id="cb22-223"><a href="#cb22-223" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-224"><a href="#cb22-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-225"><a href="#cb22-225" aria-hidden="true" tabindex="-1"></a><span class="do">## Train XGBoost models</span></span>
<span id="cb22-226"><a href="#cb22-226" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb22-227"><a href="#cb22-227" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"multi:softprob"</span>,</span>
<span id="cb22-228"><a href="#cb22-228" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_class =</span> <span class="fu">length</span>(event_levels),</span>
<span id="cb22-229"><a href="#cb22-229" aria-hidden="true" tabindex="-1"></a>  <span class="at">eval_metric =</span> <span class="st">"mlogloss"</span>,</span>
<span id="cb22-230"><a href="#cb22-230" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">6</span>,</span>
<span id="cb22-231"><a href="#cb22-231" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.05</span>,</span>
<span id="cb22-232"><a href="#cb22-232" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fl">0.8</span>,</span>
<span id="cb22-233"><a href="#cb22-233" aria-hidden="true" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="fl">0.8</span></span>
<span id="cb22-234"><a href="#cb22-234" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-235"><a href="#cb22-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-236"><a href="#cb22-236" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb22-237"><a href="#cb22-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-238"><a href="#cb22-238" aria-hidden="true" tabindex="-1"></a>xgb_swing <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb22-239"><a href="#cb22-239" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> params,</span>
<span id="cb22-240"><a href="#cb22-240" aria-hidden="true" tabindex="-1"></a>  <span class="at">data   =</span> dtrain_swing,</span>
<span id="cb22-241"><a href="#cb22-241" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="dv">200</span>,</span>
<span id="cb22-242"><a href="#cb22-242" aria-hidden="true" tabindex="-1"></a>  <span class="at">watchlist =</span> <span class="fu">list</span>(<span class="at">train =</span> dtrain_swing),</span>
<span id="cb22-243"><a href="#cb22-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">1</span></span>
<span id="cb22-244"><a href="#cb22-244" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-245"><a href="#cb22-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-246"><a href="#cb22-246" aria-hidden="true" tabindex="-1"></a>xgb_take <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb22-247"><a href="#cb22-247" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> params,</span>
<span id="cb22-248"><a href="#cb22-248" aria-hidden="true" tabindex="-1"></a>  <span class="at">data   =</span> dtrain_take,</span>
<span id="cb22-249"><a href="#cb22-249" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="dv">200</span>,</span>
<span id="cb22-250"><a href="#cb22-250" aria-hidden="true" tabindex="-1"></a>  <span class="at">watchlist =</span> <span class="fu">list</span>(<span class="at">train =</span> dtrain_take),</span>
<span id="cb22-251"><a href="#cb22-251" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">1</span></span>
<span id="cb22-252"><a href="#cb22-252" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-253"><a href="#cb22-253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-254"><a href="#cb22-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-255"><a href="#cb22-255" aria-hidden="true" tabindex="-1"></a><span class="fu"># Helper: Predict ERV(swing) and ERV(take) for any set of pitches</span></span>
<span id="cb22-258"><a href="#cb22-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-259"><a href="#cb22-259" aria-hidden="true" tabindex="-1"></a><span class="co"># This function:</span></span>
<span id="cb22-260"><a href="#cb22-260" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Uses `xgb_swing` and `xgb_take` to get outcome probabilities.  </span></span>
<span id="cb22-261"><a href="#cb22-261" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Looks up the RV for each `(event_cat, state_id)`.  </span></span>
<span id="cb22-262"><a href="#cb22-262" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Returns `ERV_swing` and `ERV_take` per row.</span></span>
<span id="cb22-263"><a href="#cb22-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-264"><a href="#cb22-264" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper: get RV vector for a given state_id (with global fallback)</span></span>
<span id="cb22-265"><a href="#cb22-265" aria-hidden="true" tabindex="-1"></a>get_rv_vec <span class="ot">&lt;-</span> <span class="cf">function</span>(state_id_i) {</span>
<span id="cb22-266"><a href="#cb22-266" aria-hidden="true" tabindex="-1"></a>  <span class="co"># RV for that state</span></span>
<span id="cb22-267"><a href="#cb22-267" aria-hidden="true" tabindex="-1"></a>  rv_i <span class="ot">&lt;-</span> rv_lookup <span class="sc">%&gt;%</span></span>
<span id="cb22-268"><a href="#cb22-268" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(state_id <span class="sc">==</span> state_id_i)</span>
<span id="cb22-269"><a href="#cb22-269" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-270"><a href="#cb22-270" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(rv_i) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb22-271"><a href="#cb22-271" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback: use global RV by event</span></span>
<span id="cb22-272"><a href="#cb22-272" aria-hidden="true" tabindex="-1"></a>    rv_i <span class="ot">&lt;-</span> rv_global <span class="sc">%&gt;%</span></span>
<span id="cb22-273"><a href="#cb22-273" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">avg_rv =</span> avg_rv_global)</span>
<span id="cb22-274"><a href="#cb22-274" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-275"><a href="#cb22-275" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-276"><a href="#cb22-276" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Align with event_levels</span></span>
<span id="cb22-277"><a href="#cb22-277" aria-hidden="true" tabindex="-1"></a>  rv_vec <span class="ot">&lt;-</span> rv_i<span class="sc">$</span>avg_rv[<span class="fu">match</span>(event_levels, rv_i<span class="sc">$</span>event_cat)]</span>
<span id="cb22-278"><a href="#cb22-278" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replace NA with 0 (rare events with no RV estimate)</span></span>
<span id="cb22-279"><a href="#cb22-279" aria-hidden="true" tabindex="-1"></a>  rv_vec[<span class="fu">is.na</span>(rv_vec)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-280"><a href="#cb22-280" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-281"><a href="#cb22-281" aria-hidden="true" tabindex="-1"></a>  rv_vec</span>
<span id="cb22-282"><a href="#cb22-282" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-283"><a href="#cb22-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-284"><a href="#cb22-284" aria-hidden="true" tabindex="-1"></a><span class="co"># Main function: ERV for swing vs take</span></span>
<span id="cb22-285"><a href="#cb22-285" aria-hidden="true" tabindex="-1"></a>predict_erv_decision <span class="ot">&lt;-</span> <span class="cf">function</span>(X_mat, state_vec) {</span>
<span id="cb22-286"><a href="#cb22-286" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X_mat)</span>
<span id="cb22-287"><a href="#cb22-287" aria-hidden="true" tabindex="-1"></a>  C <span class="ot">&lt;-</span> <span class="fu">length</span>(event_levels)</span>
<span id="cb22-288"><a href="#cb22-288" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-289"><a href="#cb22-289" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Predict probabilities</span></span>
<span id="cb22-290"><a href="#cb22-290" aria-hidden="true" tabindex="-1"></a>  pswing <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_swing, <span class="at">newdata =</span> X_mat)</span>
<span id="cb22-291"><a href="#cb22-291" aria-hidden="true" tabindex="-1"></a>  ptake  <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_take,  <span class="at">newdata =</span> X_mat)</span>
<span id="cb22-292"><a href="#cb22-292" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-293"><a href="#cb22-293" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reshape to n x C</span></span>
<span id="cb22-294"><a href="#cb22-294" aria-hidden="true" tabindex="-1"></a>  pswing <span class="ot">&lt;-</span> <span class="fu">matrix</span>(pswing, <span class="at">nrow =</span> n, <span class="at">ncol =</span> C, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-295"><a href="#cb22-295" aria-hidden="true" tabindex="-1"></a>  ptake  <span class="ot">&lt;-</span> <span class="fu">matrix</span>(ptake,  <span class="at">nrow =</span> n, <span class="at">ncol =</span> C, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-296"><a href="#cb22-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(pswing) <span class="ot">&lt;-</span> event_levels</span>
<span id="cb22-297"><a href="#cb22-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(ptake)  <span class="ot">&lt;-</span> event_levels</span>
<span id="cb22-298"><a href="#cb22-298" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-299"><a href="#cb22-299" aria-hidden="true" tabindex="-1"></a>  erv_swing <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb22-300"><a href="#cb22-300" aria-hidden="true" tabindex="-1"></a>  erv_take  <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb22-301"><a href="#cb22-301" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-302"><a href="#cb22-302" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n)) {</span>
<span id="cb22-303"><a href="#cb22-303" aria-hidden="true" tabindex="-1"></a>    rv_vec <span class="ot">&lt;-</span> <span class="fu">get_rv_vec</span>(state_vec[i])</span>
<span id="cb22-304"><a href="#cb22-304" aria-hidden="true" tabindex="-1"></a>    erv_swing[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(pswing[i, ] <span class="sc">*</span> rv_vec)</span>
<span id="cb22-305"><a href="#cb22-305" aria-hidden="true" tabindex="-1"></a>    erv_take[i]  <span class="ot">&lt;-</span> <span class="fu">sum</span>(ptake[i, ]  <span class="sc">*</span> rv_vec)</span>
<span id="cb22-306"><a href="#cb22-306" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-307"><a href="#cb22-307" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-308"><a href="#cb22-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb22-309"><a href="#cb22-309" aria-hidden="true" tabindex="-1"></a>    <span class="at">erv_swing =</span> erv_swing,</span>
<span id="cb22-310"><a href="#cb22-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">erv_take  =</span> erv_take</span>
<span id="cb22-311"><a href="#cb22-311" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-312"><a href="#cb22-312" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-313"><a href="#cb22-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-314"><a href="#cb22-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-315"><a href="#cb22-315" aria-hidden="true" tabindex="-1"></a><span class="fu"># Compute ERV(swing), ERV(take) and Decision Value for all pitches</span></span>
<span id="cb22-318"><a href="#cb22-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-319"><a href="#cb22-319" aria-hidden="true" tabindex="-1"></a><span class="co"># Here I apply the helper to **every modeled pitch**, then compute **decision value** per pitch and aggregate to SDV.</span></span>
<span id="cb22-320"><a href="#cb22-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-321"><a href="#cb22-321" aria-hidden="true" tabindex="-1"></a><span class="co"># ERV for all modeled pitches</span></span>
<span id="cb22-322"><a href="#cb22-322" aria-hidden="true" tabindex="-1"></a>erv_all <span class="ot">&lt;-</span> <span class="fu">predict_erv_decision</span>(</span>
<span id="cb22-323"><a href="#cb22-323" aria-hidden="true" tabindex="-1"></a>  <span class="at">X_mat    =</span> X_full,</span>
<span id="cb22-324"><a href="#cb22-324" aria-hidden="true" tabindex="-1"></a>  <span class="at">state_vec =</span> sc_model<span class="sc">$</span>state_id</span>
<span id="cb22-325"><a href="#cb22-325" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-326"><a href="#cb22-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-327"><a href="#cb22-327" aria-hidden="true" tabindex="-1"></a><span class="co"># Decision value per pitch:</span></span>
<span id="cb22-328"><a href="#cb22-328" aria-hidden="true" tabindex="-1"></a><span class="co"># if swing:   DV = ERV_swing - ERV_take</span></span>
<span id="cb22-329"><a href="#cb22-329" aria-hidden="true" tabindex="-1"></a><span class="co"># if take:    DV = ERV_take  - ERV_swing</span></span>
<span id="cb22-330"><a href="#cb22-330" aria-hidden="true" tabindex="-1"></a>sc_results <span class="ot">&lt;-</span> sc_model <span class="sc">%&gt;%</span></span>
<span id="cb22-331"><a href="#cb22-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-332"><a href="#cb22-332" aria-hidden="true" tabindex="-1"></a>    <span class="at">erv_swing_hat   =</span> erv_all<span class="sc">$</span>erv_swing,</span>
<span id="cb22-333"><a href="#cb22-333" aria-hidden="true" tabindex="-1"></a>    <span class="at">erv_take_hat    =</span> erv_all<span class="sc">$</span>erv_take,</span>
<span id="cb22-334"><a href="#cb22-334" aria-hidden="true" tabindex="-1"></a>    <span class="at">decision_value  =</span> <span class="fu">ifelse</span>(is_swing <span class="sc">==</span> <span class="dv">1</span>L,</span>
<span id="cb22-335"><a href="#cb22-335" aria-hidden="true" tabindex="-1"></a>                             erv_swing_hat <span class="sc">-</span> erv_take_hat,</span>
<span id="cb22-336"><a href="#cb22-336" aria-hidden="true" tabindex="-1"></a>                             erv_take_hat  <span class="sc">-</span> erv_swing_hat)</span>
<span id="cb22-337"><a href="#cb22-337" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-338"><a href="#cb22-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-339"><a href="#cb22-339" aria-hidden="true" tabindex="-1"></a>sc_results_named <span class="ot">&lt;-</span> sc_results <span class="sc">%&gt;%</span></span>
<span id="cb22-340"><a href="#cb22-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb22-341"><a href="#cb22-341" aria-hidden="true" tabindex="-1"></a>    batter_name_from_des <span class="sc">%&gt;%</span></span>
<span id="cb22-342"><a href="#cb22-342" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(batter, batter_name),</span>
<span id="cb22-343"><a href="#cb22-343" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"batter"</span></span>
<span id="cb22-344"><a href="#cb22-344" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb22-345"><a href="#cb22-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-346"><a href="#cb22-346" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fallback label if we couldn't parse a name from des</span></span>
<span id="cb22-347"><a href="#cb22-347" aria-hidden="true" tabindex="-1"></a>    <span class="at">batter_name =</span> <span class="fu">if_else</span>(</span>
<span id="cb22-348"><a href="#cb22-348" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(batter_name),</span>
<span id="cb22-349"><a href="#cb22-349" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"Unknown_"</span>, batter),</span>
<span id="cb22-350"><a href="#cb22-350" aria-hidden="true" tabindex="-1"></a>      batter_name</span>
<span id="cb22-351"><a href="#cb22-351" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-352"><a href="#cb22-352" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-353"><a href="#cb22-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-354"><a href="#cb22-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-355"><a href="#cb22-355" aria-hidden="true" tabindex="-1"></a><span class="fu"># Swing Decision Value (SDV) by Batter</span></span>
<span id="cb22-358"><a href="#cb22-358" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-359"><a href="#cb22-359" aria-hidden="true" tabindex="-1"></a>sdv_batter <span class="ot">&lt;-</span> sc_results_named <span class="sc">%&gt;%</span></span>
<span id="cb22-360"><a href="#cb22-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(batter, batter_name) <span class="sc">%&gt;%</span></span>
<span id="cb22-361"><a href="#cb22-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb22-362"><a href="#cb22-362" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_pitches =</span> <span class="fu">n</span>(),</span>
<span id="cb22-363"><a href="#cb22-363" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_swings  =</span> <span class="fu">sum</span>(is_swing),</span>
<span id="cb22-364"><a href="#cb22-364" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_dv  =</span> <span class="fu">sum</span>(decision_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-365"><a href="#cb22-365" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_dv   =</span> <span class="fu">mean</span>(decision_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-366"><a href="#cb22-366" aria-hidden="true" tabindex="-1"></a>    <span class="at">dv_per_100_decisions =</span> <span class="dv">100</span> <span class="sc">*</span> mean_dv,</span>
<span id="cb22-367"><a href="#cb22-367" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb22-368"><a href="#cb22-368" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb22-369"><a href="#cb22-369" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Minimum opportunities filter (I picked 150 arbitrarily)</span></span>
<span id="cb22-370"><a href="#cb22-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_pitches <span class="sc">&gt;=</span> <span class="dv">150</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-371"><a href="#cb22-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dv_per_100_decisions))</span>
<span id="cb22-372"><a href="#cb22-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-373"><a href="#cb22-373" aria-hidden="true" tabindex="-1"></a>sdv_batter</span>
<span id="cb22-374"><a href="#cb22-374" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-375"><a href="#cb22-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-376"><a href="#cb22-376" aria-hidden="true" tabindex="-1"></a><span class="fu"># SDV Leaderboard Plots</span></span>
<span id="cb22-379"><a href="#cb22-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-380"><a href="#cb22-380" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 15</span></span>
<span id="cb22-381"><a href="#cb22-381" aria-hidden="true" tabindex="-1"></a>sdv_top <span class="ot">&lt;-</span> sdv_batter <span class="sc">%&gt;%</span></span>
<span id="cb22-382"><a href="#cb22-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(dv_per_100_decisions, <span class="at">n =</span> <span class="dv">15</span>)</span>
<span id="cb22-383"><a href="#cb22-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-384"><a href="#cb22-384" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sdv_top,</span>
<span id="cb22-385"><a href="#cb22-385" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(batter_name, dv_per_100_decisions),</span>
<span id="cb22-386"><a href="#cb22-386" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> dv_per_100_decisions)) <span class="sc">+</span></span>
<span id="cb22-387"><a href="#cb22-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb22-388"><a href="#cb22-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb22-389"><a href="#cb22-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-390"><a href="#cb22-390" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 15 Hitters by Swing Decision Value (2025 sample)"</span>,</span>
<span id="cb22-391"><a href="#cb22-391" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb22-392"><a href="#cb22-392" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Runs per 100 swing decisions"</span></span>
<span id="cb22-393"><a href="#cb22-393" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-394"><a href="#cb22-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb22-395"><a href="#cb22-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-396"><a href="#cb22-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-399"><a href="#cb22-399" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-400"><a href="#cb22-400" aria-hidden="true" tabindex="-1"></a><span class="co"># Bottom 15</span></span>
<span id="cb22-401"><a href="#cb22-401" aria-hidden="true" tabindex="-1"></a>sdv_bottom <span class="ot">&lt;-</span> sdv_batter <span class="sc">%&gt;%</span></span>
<span id="cb22-402"><a href="#cb22-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(dv_per_100_decisions, <span class="at">n =</span> <span class="dv">15</span>)</span>
<span id="cb22-403"><a href="#cb22-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-404"><a href="#cb22-404" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sdv_bottom,</span>
<span id="cb22-405"><a href="#cb22-405" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(batter_name, dv_per_100_decisions),</span>
<span id="cb22-406"><a href="#cb22-406" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> dv_per_100_decisions)) <span class="sc">+</span></span>
<span id="cb22-407"><a href="#cb22-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb22-408"><a href="#cb22-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb22-409"><a href="#cb22-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-410"><a href="#cb22-410" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Bottom 15 Hitters by Swing Decision Value (2025 sample)"</span>,</span>
<span id="cb22-411"><a href="#cb22-411" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb22-412"><a href="#cb22-412" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Runs per 100 swing decisions"</span></span>
<span id="cb22-413"><a href="#cb22-413" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-414"><a href="#cb22-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb22-415"><a href="#cb22-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-416"><a href="#cb22-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-417"><a href="#cb22-417" aria-hidden="true" tabindex="-1"></a><span class="fu"># SDV Decomposition: In-Zone vs Out-of-Zone</span></span>
<span id="cb22-418"><a href="#cb22-418" aria-hidden="true" tabindex="-1"></a><span class="fu">## This gives a “zone discipline vs chase discipline” flavor, letting you say things like:</span></span>
<span id="cb22-419"><a href="#cb22-419" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hitter X adds the most value by not chasing (out-of-zone SDV).”</span></span>
<span id="cb22-420"><a href="#cb22-420" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hitter Y is great at attacking in-zone pitches but leaks value out of the zone.”</span></span>
<span id="cb22-423"><a href="#cb22-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-424"><a href="#cb22-424" aria-hidden="true" tabindex="-1"></a>sc_results_named <span class="ot">&lt;-</span> sc_results_named <span class="sc">%&gt;%</span></span>
<span id="cb22-425"><a href="#cb22-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-426"><a href="#cb22-426" aria-hidden="true" tabindex="-1"></a>    <span class="at">in_zone =</span> <span class="fu">ifelse</span>(zone <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="st">"In-Zone"</span>, <span class="st">"Out-of-Zone"</span>)</span>
<span id="cb22-427"><a href="#cb22-427" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-428"><a href="#cb22-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-429"><a href="#cb22-429" aria-hidden="true" tabindex="-1"></a>sdv_batter_zone <span class="ot">&lt;-</span> sc_results_named <span class="sc">%&gt;%</span></span>
<span id="cb22-430"><a href="#cb22-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(batter, batter_name, in_zone) <span class="sc">%&gt;%</span></span>
<span id="cb22-431"><a href="#cb22-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb22-432"><a href="#cb22-432" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_pitches =</span> <span class="fu">n</span>(),</span>
<span id="cb22-433"><a href="#cb22-433" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_swings  =</span> <span class="fu">sum</span>(is_swing),</span>
<span id="cb22-434"><a href="#cb22-434" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_dv  =</span> <span class="fu">sum</span>(decision_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-435"><a href="#cb22-435" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_dv   =</span> <span class="fu">mean</span>(decision_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-436"><a href="#cb22-436" aria-hidden="true" tabindex="-1"></a>    <span class="at">dv_per_100_decisions =</span> <span class="dv">100</span> <span class="sc">*</span> mean_dv,</span>
<span id="cb22-437"><a href="#cb22-437" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb22-438"><a href="#cb22-438" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb22-439"><a href="#cb22-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_pitches <span class="sc">&gt;=</span> <span class="dv">10</span>)  <span class="co"># small per-bucket threshold</span></span>
<span id="cb22-440"><a href="#cb22-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-441"><a href="#cb22-441" aria-hidden="true" tabindex="-1"></a>sdv_batter_zone <span class="sc">%&gt;%</span></span>
<span id="cb22-442"><a href="#cb22-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dv_per_100_decisions)) <span class="sc">%&gt;%</span></span>
<span id="cb22-443"><a href="#cb22-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb22-444"><a href="#cb22-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-445"><a href="#cb22-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-446"><a href="#cb22-446" aria-hidden="true" tabindex="-1"></a><span class="fu"># Neutral Decision Value Surface (league-average)</span></span>
<span id="cb22-449"><a href="#cb22-449" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-450"><a href="#cb22-450" aria-hidden="true" tabindex="-1"></a>make_sim_grid <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">pitch_type =</span> <span class="st">"FF"</span>) {</span>
<span id="cb22-451"><a href="#cb22-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_grid</span>(</span>
<span id="cb22-452"><a href="#cb22-452" aria-hidden="true" tabindex="-1"></a>    <span class="at">plate_x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="at">length.out =</span> <span class="dv">40</span>),</span>
<span id="cb22-453"><a href="#cb22-453" aria-hidden="true" tabindex="-1"></a>    <span class="at">plate_z =</span> <span class="fu">seq</span>(<span class="fl">1.0</span>, <span class="fl">4.0</span>, <span class="at">length.out =</span> <span class="dv">40</span>)</span>
<span id="cb22-454"><a href="#cb22-454" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb22-455"><a href="#cb22-455" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb22-456"><a href="#cb22-456" aria-hidden="true" tabindex="-1"></a>      <span class="at">zone              =</span> <span class="cn">NA_real_</span>,   <span class="co"># let model infer via location</span></span>
<span id="cb22-457"><a href="#cb22-457" aria-hidden="true" tabindex="-1"></a>      <span class="at">release_speed     =</span> <span class="dv">94</span>,</span>
<span id="cb22-458"><a href="#cb22-458" aria-hidden="true" tabindex="-1"></a>      <span class="at">pfx_x             =</span> <span class="dv">0</span>,</span>
<span id="cb22-459"><a href="#cb22-459" aria-hidden="true" tabindex="-1"></a>      <span class="at">pfx_z             =</span> <span class="dv">10</span>,</span>
<span id="cb22-460"><a href="#cb22-460" aria-hidden="true" tabindex="-1"></a>      <span class="at">release_extension =</span> <span class="fl">6.0</span>,</span>
<span id="cb22-461"><a href="#cb22-461" aria-hidden="true" tabindex="-1"></a>      <span class="at">balls             =</span> <span class="dv">0</span>,</span>
<span id="cb22-462"><a href="#cb22-462" aria-hidden="true" tabindex="-1"></a>      <span class="at">strikes           =</span> <span class="dv">0</span>,</span>
<span id="cb22-463"><a href="#cb22-463" aria-hidden="true" tabindex="-1"></a>      <span class="at">outs_when_up      =</span> <span class="dv">0</span>,</span>
<span id="cb22-464"><a href="#cb22-464" aria-hidden="true" tabindex="-1"></a>      <span class="at">inning            =</span> <span class="dv">1</span>,</span>
<span id="cb22-465"><a href="#cb22-465" aria-hidden="true" tabindex="-1"></a>      <span class="at">home_score_diff   =</span> <span class="dv">0</span>,</span>
<span id="cb22-466"><a href="#cb22-466" aria-hidden="true" tabindex="-1"></a>      <span class="at">bat_score_diff    =</span> <span class="dv">0</span>,</span>
<span id="cb22-467"><a href="#cb22-467" aria-hidden="true" tabindex="-1"></a>      <span class="at">stand             =</span> <span class="st">"R"</span>,</span>
<span id="cb22-468"><a href="#cb22-468" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_throws          =</span> <span class="st">"R"</span>,</span>
<span id="cb22-469"><a href="#cb22-469" aria-hidden="true" tabindex="-1"></a>      <span class="at">pitch_type        =</span> pitch_type,</span>
<span id="cb22-470"><a href="#cb22-470" aria-hidden="true" tabindex="-1"></a>      <span class="at">base_state        =</span> <span class="st">"000"</span>,</span>
<span id="cb22-471"><a href="#cb22-471" aria-hidden="true" tabindex="-1"></a>      <span class="at">count_str         =</span> <span class="st">"0-0"</span>,</span>
<span id="cb22-472"><a href="#cb22-472" aria-hidden="true" tabindex="-1"></a>      <span class="at">state_id          =</span> <span class="fu">paste</span>(base_state, outs_when_up, count_str, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb22-473"><a href="#cb22-473" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-474"><a href="#cb22-474" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-475"><a href="#cb22-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-476"><a href="#cb22-476" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Build neutral grid</span></span>
<span id="cb22-477"><a href="#cb22-477" aria-hidden="true" tabindex="-1"></a>sim_grid <span class="ot">&lt;-</span> <span class="fu">make_sim_grid</span>(<span class="st">"FF"</span>)</span>
<span id="cb22-478"><a href="#cb22-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-479"><a href="#cb22-479" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Match numeric preprocessing from model_df</span></span>
<span id="cb22-480"><a href="#cb22-480" aria-hidden="true" tabindex="-1"></a>sim_grid <span class="ot">&lt;-</span> sim_grid <span class="sc">%&gt;%</span></span>
<span id="cb22-481"><a href="#cb22-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-482"><a href="#cb22-482" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">all_of</span>(num_vars), as.numeric)</span>
<span id="cb22-483"><a href="#cb22-483" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-484"><a href="#cb22-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-485"><a href="#cb22-485" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Handle categoricals and force same factor levels as in training</span></span>
<span id="cb22-486"><a href="#cb22-486" aria-hidden="true" tabindex="-1"></a><span class="co">#    - replace NA with "UNK"</span></span>
<span id="cb22-487"><a href="#cb22-487" aria-hidden="true" tabindex="-1"></a><span class="co">#    - use levels from model_df so sparse.model.matrix sees full factor space</span></span>
<span id="cb22-488"><a href="#cb22-488" aria-hidden="true" tabindex="-1"></a>sim_grid <span class="ot">&lt;-</span> sim_grid <span class="sc">%&gt;%</span></span>
<span id="cb22-489"><a href="#cb22-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-490"><a href="#cb22-490" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">all_of</span>(cat_vars), <span class="sc">~</span><span class="fu">replace_na</span>(<span class="fu">as.character</span>(.x), <span class="st">"UNK"</span>))</span>
<span id="cb22-491"><a href="#cb22-491" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-492"><a href="#cb22-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-493"><a href="#cb22-493" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> cat_vars) {</span>
<span id="cb22-494"><a href="#cb22-494" aria-hidden="true" tabindex="-1"></a>  sim_grid[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(sim_grid[[v]],</span>
<span id="cb22-495"><a href="#cb22-495" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(model_df[[v]])))</span>
<span id="cb22-496"><a href="#cb22-496" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-497"><a href="#cb22-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-498"><a href="#cb22-498" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Build design matrices using the SAME dummy_formula as training</span></span>
<span id="cb22-499"><a href="#cb22-499" aria-hidden="true" tabindex="-1"></a>X_sim_num <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(sim_grid[, num_vars])</span>
<span id="cb22-500"><a href="#cb22-500" aria-hidden="true" tabindex="-1"></a>X_sim_cat <span class="ot">&lt;-</span> <span class="fu">sparse.model.matrix</span>(dummy_formula, <span class="at">data =</span> sim_grid)</span>
<span id="cb22-501"><a href="#cb22-501" aria-hidden="true" tabindex="-1"></a>X_sim <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_sim_num, X_sim_cat)</span>
<span id="cb22-502"><a href="#cb22-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-503"><a href="#cb22-503" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Get ERV(swing) and ERV(take) for the grid</span></span>
<span id="cb22-504"><a href="#cb22-504" aria-hidden="true" tabindex="-1"></a>erv_sim <span class="ot">&lt;-</span> <span class="fu">predict_erv_decision</span>(X_sim, sim_grid<span class="sc">$</span>state_id)</span>
<span id="cb22-505"><a href="#cb22-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-506"><a href="#cb22-506" aria-hidden="true" tabindex="-1"></a>sim_grid <span class="ot">&lt;-</span> sim_grid <span class="sc">%&gt;%</span></span>
<span id="cb22-507"><a href="#cb22-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(erv_sim) <span class="sc">%&gt;%</span></span>
<span id="cb22-508"><a href="#cb22-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decision_value =</span> erv_swing <span class="sc">-</span> erv_take)</span>
<span id="cb22-509"><a href="#cb22-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-510"><a href="#cb22-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-513"><a href="#cb22-513" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-514"><a href="#cb22-514" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_grid, <span class="fu">aes</span>(<span class="at">x =</span> plate_x, <span class="at">y =</span> plate_z, <span class="at">fill =</span> decision_value)) <span class="sc">+</span></span>
<span id="cb22-515"><a href="#cb22-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb22-516"><a href="#cb22-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb22-517"><a href="#cb22-517" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb22-518"><a href="#cb22-518" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb22-519"><a href="#cb22-519" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"ERV(swing) - ERV(take)"</span></span>
<span id="cb22-520"><a href="#cb22-520" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-521"><a href="#cb22-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb22-522"><a href="#cb22-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb22-523"><a href="#cb22-523" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rect"</span>,</span>
<span id="cb22-524"><a href="#cb22-524" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">0.83</span>, <span class="at">xmax =</span> <span class="fl">0.83</span>,</span>
<span id="cb22-525"><a href="#cb22-525" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="fl">1.5</span>,  <span class="at">ymax =</span> <span class="fl">3.5</span>,</span>
<span id="cb22-526"><a href="#cb22-526" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span></span>
<span id="cb22-527"><a href="#cb22-527" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-528"><a href="#cb22-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-529"><a href="#cb22-529" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Neutral Decision Value Surface (R vs R, FF, 0-0, bases empty)"</span>,</span>
<span id="cb22-530"><a href="#cb22-530" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Plate X (ft, catcher view)"</span>,</span>
<span id="cb22-531"><a href="#cb22-531" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Plate Z (ft)"</span></span>
<span id="cb22-532"><a href="#cb22-532" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-533"><a href="#cb22-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb22-534"><a href="#cb22-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-535"><a href="#cb22-535" aria-hidden="true" tabindex="-1"></a><span class="fu"># Interpretation</span></span>
<span id="cb22-536"><a href="#cb22-536" aria-hidden="true" tabindex="-1"></a>This surface shows the neutral swing decision landscape for a representative RHP vs RHB four-seam fastball in a 0–0 count with bases empty. The colors represent ERV(swing) – ERV(take) at each location in the strike zone, where negative values mean the model believes a take is (on average) the better run-value decision, while positive values would favor a swing. Interestingly, the entire map is shaded slightly negative, including most of the strike zone. That might look counterintuitive at first, but it actually reflects the underlying run-value baseline: in an average, league-wide 0–0 count, taking a pitch is usually a slightly better expected-value outcome than swinging, unless the pitch is in a particularly damage-prone location. Swings only produce sizable positive RV on a small subset of outcomes (solid contact), whereas takes avoid most of the negative RV from weak contact or whiffs. Because the map here is neutralized across all hitters and pitchers, it’s intentionally “flat” — showing that, on average, hitters don’t gain RV by swinging at random zone locations, and that the positive-value swing regions for specific hitters emerge only when we condition on their profiles later.</span>
<span id="cb22-537"><a href="#cb22-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-538"><a href="#cb22-538" aria-hidden="true" tabindex="-1"></a><span class="fu"># Same plot but for 0-2 counts</span></span>
<span id="cb22-541"><a href="#cb22-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-542"><a href="#cb22-542" aria-hidden="true" tabindex="-1"></a><span class="co"># Build neutral grid for 0-2</span></span>
<span id="cb22-543"><a href="#cb22-543" aria-hidden="true" tabindex="-1"></a>sim_grid_02 <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb22-544"><a href="#cb22-544" aria-hidden="true" tabindex="-1"></a>  <span class="at">plate_x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="at">length.out =</span> <span class="dv">40</span>),</span>
<span id="cb22-545"><a href="#cb22-545" aria-hidden="true" tabindex="-1"></a>  <span class="at">plate_z =</span> <span class="fu">seq</span>(<span class="fl">1.0</span>, <span class="fl">4.0</span>, <span class="at">length.out =</span> <span class="dv">40</span>)</span>
<span id="cb22-546"><a href="#cb22-546" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb22-547"><a href="#cb22-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-548"><a href="#cb22-548" aria-hidden="true" tabindex="-1"></a>    <span class="at">zone              =</span> <span class="cn">NA_real_</span>,   <span class="co"># let model infer via location</span></span>
<span id="cb22-549"><a href="#cb22-549" aria-hidden="true" tabindex="-1"></a>    <span class="at">release_speed     =</span> <span class="dv">94</span>,</span>
<span id="cb22-550"><a href="#cb22-550" aria-hidden="true" tabindex="-1"></a>    <span class="at">pfx_x             =</span> <span class="dv">0</span>,</span>
<span id="cb22-551"><a href="#cb22-551" aria-hidden="true" tabindex="-1"></a>    <span class="at">pfx_z             =</span> <span class="dv">10</span>,</span>
<span id="cb22-552"><a href="#cb22-552" aria-hidden="true" tabindex="-1"></a>    <span class="at">release_extension =</span> <span class="fl">6.0</span>,</span>
<span id="cb22-553"><a href="#cb22-553" aria-hidden="true" tabindex="-1"></a>    <span class="at">balls             =</span> <span class="dv">0</span>,</span>
<span id="cb22-554"><a href="#cb22-554" aria-hidden="true" tabindex="-1"></a>    <span class="at">strikes           =</span> <span class="dv">2</span>,          <span class="co"># &lt;-- 0-2 count</span></span>
<span id="cb22-555"><a href="#cb22-555" aria-hidden="true" tabindex="-1"></a>    <span class="at">outs_when_up      =</span> <span class="dv">0</span>,</span>
<span id="cb22-556"><a href="#cb22-556" aria-hidden="true" tabindex="-1"></a>    <span class="at">inning            =</span> <span class="dv">1</span>,</span>
<span id="cb22-557"><a href="#cb22-557" aria-hidden="true" tabindex="-1"></a>    <span class="at">home_score_diff   =</span> <span class="dv">0</span>,</span>
<span id="cb22-558"><a href="#cb22-558" aria-hidden="true" tabindex="-1"></a>    <span class="at">bat_score_diff    =</span> <span class="dv">0</span>,</span>
<span id="cb22-559"><a href="#cb22-559" aria-hidden="true" tabindex="-1"></a>    <span class="at">stand             =</span> <span class="st">"R"</span>,</span>
<span id="cb22-560"><a href="#cb22-560" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_throws          =</span> <span class="st">"R"</span>,</span>
<span id="cb22-561"><a href="#cb22-561" aria-hidden="true" tabindex="-1"></a>    <span class="at">pitch_type        =</span> <span class="st">"FF"</span>,</span>
<span id="cb22-562"><a href="#cb22-562" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_state        =</span> <span class="st">"000"</span>,</span>
<span id="cb22-563"><a href="#cb22-563" aria-hidden="true" tabindex="-1"></a>    <span class="at">count_str         =</span> <span class="st">"0-2"</span>,      <span class="co"># &lt;-- 0-2 label</span></span>
<span id="cb22-564"><a href="#cb22-564" aria-hidden="true" tabindex="-1"></a>    <span class="at">state_id          =</span> <span class="fu">paste</span>(base_state, outs_when_up, count_str, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb22-565"><a href="#cb22-565" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-566"><a href="#cb22-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-567"><a href="#cb22-567" aria-hidden="true" tabindex="-1"></a><span class="co"># Match numeric preprocessing from model_df</span></span>
<span id="cb22-568"><a href="#cb22-568" aria-hidden="true" tabindex="-1"></a>sim_grid_02 <span class="ot">&lt;-</span> sim_grid_02 <span class="sc">%&gt;%</span></span>
<span id="cb22-569"><a href="#cb22-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-570"><a href="#cb22-570" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">all_of</span>(num_vars), as.numeric)</span>
<span id="cb22-571"><a href="#cb22-571" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-572"><a href="#cb22-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-573"><a href="#cb22-573" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle categoricals and force same factor levels as in training</span></span>
<span id="cb22-574"><a href="#cb22-574" aria-hidden="true" tabindex="-1"></a>sim_grid_02 <span class="ot">&lt;-</span> sim_grid_02 <span class="sc">%&gt;%</span></span>
<span id="cb22-575"><a href="#cb22-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-576"><a href="#cb22-576" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">all_of</span>(cat_vars), <span class="sc">~</span><span class="fu">replace_na</span>(<span class="fu">as.character</span>(.x), <span class="st">"UNK"</span>))</span>
<span id="cb22-577"><a href="#cb22-577" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-578"><a href="#cb22-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-579"><a href="#cb22-579" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> cat_vars) {</span>
<span id="cb22-580"><a href="#cb22-580" aria-hidden="true" tabindex="-1"></a>  sim_grid_02[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb22-581"><a href="#cb22-581" aria-hidden="true" tabindex="-1"></a>    sim_grid_02[[v]],</span>
<span id="cb22-582"><a href="#cb22-582" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(model_df[[v]]))</span>
<span id="cb22-583"><a href="#cb22-583" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-584"><a href="#cb22-584" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-585"><a href="#cb22-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-586"><a href="#cb22-586" aria-hidden="true" tabindex="-1"></a><span class="co"># Build design matrices using the SAME dummy_formula as training</span></span>
<span id="cb22-587"><a href="#cb22-587" aria-hidden="true" tabindex="-1"></a>X_sim_num_02 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(sim_grid_02[, num_vars])</span>
<span id="cb22-588"><a href="#cb22-588" aria-hidden="true" tabindex="-1"></a>X_sim_cat_02 <span class="ot">&lt;-</span> <span class="fu">sparse.model.matrix</span>(dummy_formula, <span class="at">data =</span> sim_grid_02)</span>
<span id="cb22-589"><a href="#cb22-589" aria-hidden="true" tabindex="-1"></a>X_sim_02 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_sim_num_02, X_sim_cat_02)</span>
<span id="cb22-590"><a href="#cb22-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-591"><a href="#cb22-591" aria-hidden="true" tabindex="-1"></a><span class="co"># Get ERV(swing) and ERV(take) for the 0-2 grid</span></span>
<span id="cb22-592"><a href="#cb22-592" aria-hidden="true" tabindex="-1"></a>erv_sim_02 <span class="ot">&lt;-</span> <span class="fu">predict_erv_decision</span>(X_sim_02, sim_grid_02<span class="sc">$</span>state_id)</span>
<span id="cb22-593"><a href="#cb22-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-594"><a href="#cb22-594" aria-hidden="true" tabindex="-1"></a>sim_grid_02 <span class="ot">&lt;-</span> sim_grid_02 <span class="sc">%&gt;%</span></span>
<span id="cb22-595"><a href="#cb22-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(erv_sim_02) <span class="sc">%&gt;%</span></span>
<span id="cb22-596"><a href="#cb22-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decision_value =</span> erv_swing <span class="sc">-</span> erv_take)</span>
<span id="cb22-597"><a href="#cb22-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-598"><a href="#cb22-598" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb22-599"><a href="#cb22-599" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_grid_02, <span class="fu">aes</span>(<span class="at">x =</span> plate_x, <span class="at">y =</span> plate_z, <span class="at">fill =</span> decision_value)) <span class="sc">+</span></span>
<span id="cb22-600"><a href="#cb22-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb22-601"><a href="#cb22-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb22-602"><a href="#cb22-602" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb22-603"><a href="#cb22-603" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb22-604"><a href="#cb22-604" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"ERV(swing) - ERV(take)"</span></span>
<span id="cb22-605"><a href="#cb22-605" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-606"><a href="#cb22-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb22-607"><a href="#cb22-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb22-608"><a href="#cb22-608" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rect"</span>,</span>
<span id="cb22-609"><a href="#cb22-609" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">0.83</span>, <span class="at">xmax =</span> <span class="fl">0.83</span>,</span>
<span id="cb22-610"><a href="#cb22-610" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="fl">1.5</span>,  <span class="at">ymax =</span> <span class="fl">3.5</span>,</span>
<span id="cb22-611"><a href="#cb22-611" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span></span>
<span id="cb22-612"><a href="#cb22-612" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-613"><a href="#cb22-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-614"><a href="#cb22-614" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Neutral Decision Value Surface (R vs R, FF, 0-2, bases empty)"</span>,</span>
<span id="cb22-615"><a href="#cb22-615" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Plate X (ft, catcher view)"</span>,</span>
<span id="cb22-616"><a href="#cb22-616" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Plate Z (ft)"</span></span>
<span id="cb22-617"><a href="#cb22-617" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-618"><a href="#cb22-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb22-619"><a href="#cb22-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-620"><a href="#cb22-620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-621"><a href="#cb22-621" aria-hidden="true" tabindex="-1"></a><span class="fu"># Interpretation</span></span>
<span id="cb22-622"><a href="#cb22-622" aria-hidden="true" tabindex="-1"></a>This plot now shows the neutral swing decision surface for a RHP vs RHB four-seam fastball in a 0–2 count, with bases empty. Unlike the 0–0 landscape, this one flips dramatically: the entire strike zone, as well as a border surrounding the entire zone, now shows positive ERV(swing) – ERV(take). This of course makes intuitive sense. The model learned that hitters should generally be in protect mode on 0–2, expanding their swing decisions throughout the zone and even a bit beyond it. This contrast with the 0–0 plot shows that my model is capturing realistic baseball behavior driven by run-value consequences rather than simply location-based heuristics. The plot makes me even more confident in my model.</span>
<span id="cb22-623"><a href="#cb22-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-624"><a href="#cb22-624" aria-hidden="true" tabindex="-1"></a><span class="fu"># Another couple diagnostics</span></span>
<span id="cb22-627"><a href="#cb22-627" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-628"><a href="#cb22-628" aria-hidden="true" tabindex="-1"></a>diag_df <span class="ot">&lt;-</span> sc_results_named <span class="sc">%&gt;%</span></span>
<span id="cb22-629"><a href="#cb22-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-630"><a href="#cb22-630" aria-hidden="true" tabindex="-1"></a>    <span class="at">erv_decision_hat =</span> <span class="fu">ifelse</span>(is_swing <span class="sc">==</span> <span class="dv">1</span>L, erv_swing_hat, erv_take_hat)</span>
<span id="cb22-631"><a href="#cb22-631" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-632"><a href="#cb22-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-633"><a href="#cb22-633" aria-hidden="true" tabindex="-1"></a>diag_df <span class="sc">%&gt;%</span></span>
<span id="cb22-634"><a href="#cb22-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb22-635"><a href="#cb22-635" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_actual_rv =</span> <span class="fu">mean</span>(rv, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-636"><a href="#cb22-636" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_pred_erv  =</span> <span class="fu">mean</span>(erv_decision_hat, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-637"><a href="#cb22-637" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-638"><a href="#cb22-638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-639"><a href="#cb22-639" aria-hidden="true" tabindex="-1"></a>They're extremely close, showing that my model behaves quite reasonably.</span>
<span id="cb22-640"><a href="#cb22-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-643"><a href="#cb22-643" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-644"><a href="#cb22-644" aria-hidden="true" tabindex="-1"></a>diag_by_count <span class="ot">&lt;-</span> sc_results_named <span class="sc">%&gt;%</span></span>
<span id="cb22-645"><a href="#cb22-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-646"><a href="#cb22-646" aria-hidden="true" tabindex="-1"></a>    <span class="at">count_str =</span> <span class="fu">paste0</span>(balls, <span class="st">"-"</span>, strikes),</span>
<span id="cb22-647"><a href="#cb22-647" aria-hidden="true" tabindex="-1"></a>    <span class="at">erv_decision_hat =</span> <span class="fu">ifelse</span>(is_swing <span class="sc">==</span> <span class="dv">1</span>L, erv_swing_hat, erv_take_hat)</span>
<span id="cb22-648"><a href="#cb22-648" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb22-649"><a href="#cb22-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(count_str) <span class="sc">%&gt;%</span></span>
<span id="cb22-650"><a href="#cb22-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb22-651"><a href="#cb22-651" aria-hidden="true" tabindex="-1"></a>    <span class="at">n          =</span> <span class="fu">n</span>(),</span>
<span id="cb22-652"><a href="#cb22-652" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_actual_rv =</span> <span class="fu">mean</span>(rv, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-653"><a href="#cb22-653" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_pred_erv  =</span> <span class="fu">mean</span>(erv_decision_hat, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-654"><a href="#cb22-654" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb22-655"><a href="#cb22-655" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb22-656"><a href="#cb22-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb22-657"><a href="#cb22-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-658"><a href="#cb22-658" aria-hidden="true" tabindex="-1"></a>diag_by_count <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb22-659"><a href="#cb22-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-660"><a href="#cb22-660" aria-hidden="true" tabindex="-1"></a>Better yet, my model is extremely well-calibrated across all possible counts.</span>
<span id="cb22-661"><a href="#cb22-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-662"><a href="#cb22-662" aria-hidden="true" tabindex="-1"></a><span class="fu"># CJ Abrams: Decision Value Surfaces by Count (faceted)</span></span>
<span id="cb22-665"><a href="#cb22-665" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb22-666"><a href="#cb22-666" aria-hidden="true" tabindex="-1"></a><span class="co"># Find CJ Abrams' batter ID</span></span>
<span id="cb22-667"><a href="#cb22-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-668"><a href="#cb22-668" aria-hidden="true" tabindex="-1"></a>abrams_row <span class="ot">&lt;-</span> sdv_batter <span class="sc">%&gt;%</span></span>
<span id="cb22-669"><a href="#cb22-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(batter_name, <span class="fu">regex</span>(<span class="st">"Abrams"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb22-670"><a href="#cb22-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb22-671"><a href="#cb22-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-672"><a href="#cb22-672" aria-hidden="true" tabindex="-1"></a>abrams_id   <span class="ot">&lt;-</span> abrams_row<span class="sc">$</span>batter</span>
<span id="cb22-673"><a href="#cb22-673" aria-hidden="true" tabindex="-1"></a>abrams_name <span class="ot">&lt;-</span> abrams_row<span class="sc">$</span>batter_name</span>
<span id="cb22-674"><a href="#cb22-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-675"><a href="#cb22-675" aria-hidden="true" tabindex="-1"></a>abrams_id</span>
<span id="cb22-676"><a href="#cb22-676" aria-hidden="true" tabindex="-1"></a>abrams_name</span>
<span id="cb22-677"><a href="#cb22-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-678"><a href="#cb22-678" aria-hidden="true" tabindex="-1"></a><span class="co"># All pitches for Abrams</span></span>
<span id="cb22-679"><a href="#cb22-679" aria-hidden="true" tabindex="-1"></a>abrams_pitches <span class="ot">&lt;-</span> sc_results_named <span class="sc">%&gt;%</span></span>
<span id="cb22-680"><a href="#cb22-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(batter <span class="sc">==</span> abrams_id)</span>
<span id="cb22-681"><a href="#cb22-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-682"><a href="#cb22-682" aria-hidden="true" tabindex="-1"></a><span class="co"># draw Abrams contexts for a given count</span></span>
<span id="cb22-683"><a href="#cb22-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-684"><a href="#cb22-684" aria-hidden="true" tabindex="-1"></a>draw_context_count <span class="ot">&lt;-</span> <span class="cf">function</span>(b, s, n) {</span>
<span id="cb22-685"><a href="#cb22-685" aria-hidden="true" tabindex="-1"></a>  ctx <span class="ot">&lt;-</span> abrams_pitches <span class="sc">%&gt;%</span></span>
<span id="cb22-686"><a href="#cb22-686" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(balls <span class="sc">==</span> b, strikes <span class="sc">==</span> s)</span>
<span id="cb22-687"><a href="#cb22-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-688"><a href="#cb22-688" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(ctx) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb22-689"><a href="#cb22-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-690"><a href="#cb22-690" aria-hidden="true" tabindex="-1"></a>  ctx <span class="sc">%&gt;%</span></span>
<span id="cb22-691"><a href="#cb22-691" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-692"><a href="#cb22-692" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">setdiff</span>(model_vars, <span class="fu">c</span>(<span class="st">"plate_x"</span>, <span class="st">"plate_z"</span>))), state_id)</span>
<span id="cb22-693"><a href="#cb22-693" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-694"><a href="#cb22-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-695"><a href="#cb22-695" aria-hidden="true" tabindex="-1"></a>counts_to_plot <span class="ot">&lt;-</span> abrams_pitches <span class="sc">%&gt;%</span></span>
<span id="cb22-696"><a href="#cb22-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(balls, strikes, <span class="at">name =</span> <span class="st">"n_pitches"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-697"><a href="#cb22-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(balls, strikes)</span>
<span id="cb22-698"><a href="#cb22-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-699"><a href="#cb22-699" aria-hidden="true" tabindex="-1"></a><span class="co"># Build decision surfaces for each count via Monte Carlo</span></span>
<span id="cb22-700"><a href="#cb22-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-701"><a href="#cb22-701" aria-hidden="true" tabindex="-1"></a><span class="co"># grid resolution and MC reps per grid cell</span></span>
<span id="cb22-702"><a href="#cb22-702" aria-hidden="true" tabindex="-1"></a>px_seq  <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="at">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb22-703"><a href="#cb22-703" aria-hidden="true" tabindex="-1"></a>pz_seq  <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">1.0</span>, <span class="fl">4.0</span>, <span class="at">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb22-704"><a href="#cb22-704" aria-hidden="true" tabindex="-1"></a>n_mc    <span class="ot">&lt;-</span> <span class="dv">80</span>   <span class="co"># increase for smoother surfaces, decrease for speed</span></span>
<span id="cb22-705"><a href="#cb22-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-706"><a href="#cb22-706" aria-hidden="true" tabindex="-1"></a>abrams_count_surfaces <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb22-707"><a href="#cb22-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seq_len</span>(<span class="fu">nrow</span>(counts_to_plot)),</span>
<span id="cb22-708"><a href="#cb22-708" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(i) {</span>
<span id="cb22-709"><a href="#cb22-709" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">&lt;-</span> counts_to_plot<span class="sc">$</span>balls[i]</span>
<span id="cb22-710"><a href="#cb22-710" aria-hidden="true" tabindex="-1"></a>    s <span class="ot">&lt;-</span> counts_to_plot<span class="sc">$</span>strikes[i]</span>
<span id="cb22-711"><a href="#cb22-711" aria-hidden="true" tabindex="-1"></a>    n_here <span class="ot">&lt;-</span> counts_to_plot<span class="sc">$</span>n_pitches[i]</span>
<span id="cb22-712"><a href="#cb22-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-713"><a href="#cb22-713" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grid for this count</span></span>
<span id="cb22-714"><a href="#cb22-714" aria-hidden="true" tabindex="-1"></a>    grid_cs <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb22-715"><a href="#cb22-715" aria-hidden="true" tabindex="-1"></a>      <span class="at">plate_x =</span> px_seq,</span>
<span id="cb22-716"><a href="#cb22-716" aria-hidden="true" tabindex="-1"></a>      <span class="at">plate_z =</span> pz_seq</span>
<span id="cb22-717"><a href="#cb22-717" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb22-718"><a href="#cb22-718" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb22-719"><a href="#cb22-719" aria-hidden="true" tabindex="-1"></a>        <span class="at">balls   =</span> b,</span>
<span id="cb22-720"><a href="#cb22-720" aria-hidden="true" tabindex="-1"></a>        <span class="at">strikes =</span> s,</span>
<span id="cb22-721"><a href="#cb22-721" aria-hidden="true" tabindex="-1"></a>        <span class="at">count_str =</span> <span class="fu">paste0</span>(balls, <span class="st">"-"</span>, strikes)</span>
<span id="cb22-722"><a href="#cb22-722" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb22-723"><a href="#cb22-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-724"><a href="#cb22-724" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For each grid point, Monte Carlo over Abrams' contexts at this count</span></span>
<span id="cb22-725"><a href="#cb22-725" aria-hidden="true" tabindex="-1"></a>    res_cs <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(grid_cs)), <span class="cf">function</span>(j) {</span>
<span id="cb22-726"><a href="#cb22-726" aria-hidden="true" tabindex="-1"></a>      px <span class="ot">&lt;-</span> grid_cs<span class="sc">$</span>plate_x[j]</span>
<span id="cb22-727"><a href="#cb22-727" aria-hidden="true" tabindex="-1"></a>      pz <span class="ot">&lt;-</span> grid_cs<span class="sc">$</span>plate_z[j]</span>
<span id="cb22-728"><a href="#cb22-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-729"><a href="#cb22-729" aria-hidden="true" tabindex="-1"></a>      ctx <span class="ot">&lt;-</span> <span class="fu">draw_context_count</span>(b, s, n_mc)</span>
<span id="cb22-730"><a href="#cb22-730" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(ctx)) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb22-731"><a href="#cb22-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-732"><a href="#cb22-732" aria-hidden="true" tabindex="-1"></a>      ctx <span class="ot">&lt;-</span> ctx <span class="sc">%&gt;%</span></span>
<span id="cb22-733"><a href="#cb22-733" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb22-734"><a href="#cb22-734" aria-hidden="true" tabindex="-1"></a>          <span class="at">plate_x =</span> px,</span>
<span id="cb22-735"><a href="#cb22-735" aria-hidden="true" tabindex="-1"></a>          <span class="at">plate_z =</span> pz</span>
<span id="cb22-736"><a href="#cb22-736" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb22-737"><a href="#cb22-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-738"><a href="#cb22-738" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Preprocess to match model_df</span></span>
<span id="cb22-739"><a href="#cb22-739" aria-hidden="true" tabindex="-1"></a>      ctx <span class="ot">&lt;-</span> ctx <span class="sc">%&gt;%</span></span>
<span id="cb22-740"><a href="#cb22-740" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb22-741"><a href="#cb22-741" aria-hidden="true" tabindex="-1"></a>          <span class="fu">across</span>(<span class="fu">all_of</span>(num_vars), as.numeric),</span>
<span id="cb22-742"><a href="#cb22-742" aria-hidden="true" tabindex="-1"></a>          <span class="fu">across</span>(<span class="fu">all_of</span>(cat_vars), <span class="sc">~</span><span class="fu">replace_na</span>(<span class="fu">as.character</span>(.x), <span class="st">"UNK"</span>))</span>
<span id="cb22-743"><a href="#cb22-743" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb22-744"><a href="#cb22-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-745"><a href="#cb22-745" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (v <span class="cf">in</span> cat_vars) {</span>
<span id="cb22-746"><a href="#cb22-746" aria-hidden="true" tabindex="-1"></a>        ctx[[v]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb22-747"><a href="#cb22-747" aria-hidden="true" tabindex="-1"></a>          ctx[[v]],</span>
<span id="cb22-748"><a href="#cb22-748" aria-hidden="true" tabindex="-1"></a>          <span class="at">levels =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(model_df[[v]]))</span>
<span id="cb22-749"><a href="#cb22-749" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb22-750"><a href="#cb22-750" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb22-751"><a href="#cb22-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-752"><a href="#cb22-752" aria-hidden="true" tabindex="-1"></a>      X_num_ctx <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(ctx[, num_vars])</span>
<span id="cb22-753"><a href="#cb22-753" aria-hidden="true" tabindex="-1"></a>      X_cat_ctx <span class="ot">&lt;-</span> <span class="fu">sparse.model.matrix</span>(dummy_formula, <span class="at">data =</span> ctx)</span>
<span id="cb22-754"><a href="#cb22-754" aria-hidden="true" tabindex="-1"></a>      X_ctx     <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_num_ctx, X_cat_ctx)</span>
<span id="cb22-755"><a href="#cb22-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-756"><a href="#cb22-756" aria-hidden="true" tabindex="-1"></a>      erv_ctx <span class="ot">&lt;-</span> <span class="fu">predict_erv_decision</span>(X_ctx, ctx<span class="sc">$</span>state_id)</span>
<span id="cb22-757"><a href="#cb22-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-758"><a href="#cb22-758" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(</span>
<span id="cb22-759"><a href="#cb22-759" aria-hidden="true" tabindex="-1"></a>        <span class="at">plate_x =</span> px,</span>
<span id="cb22-760"><a href="#cb22-760" aria-hidden="true" tabindex="-1"></a>        <span class="at">plate_z =</span> pz,</span>
<span id="cb22-761"><a href="#cb22-761" aria-hidden="true" tabindex="-1"></a>        <span class="at">balls   =</span> b,</span>
<span id="cb22-762"><a href="#cb22-762" aria-hidden="true" tabindex="-1"></a>        <span class="at">strikes =</span> s,</span>
<span id="cb22-763"><a href="#cb22-763" aria-hidden="true" tabindex="-1"></a>        <span class="at">count_str =</span> <span class="fu">paste0</span>(b, <span class="st">"-"</span>, s),</span>
<span id="cb22-764"><a href="#cb22-764" aria-hidden="true" tabindex="-1"></a>        <span class="at">decision_value =</span> <span class="fu">mean</span>(erv_ctx<span class="sc">$</span>erv_swing <span class="sc">-</span> erv_ctx<span class="sc">$</span>erv_take)</span>
<span id="cb22-765"><a href="#cb22-765" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb22-766"><a href="#cb22-766" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb22-767"><a href="#cb22-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-768"><a href="#cb22-768" aria-hidden="true" tabindex="-1"></a>    res_cs</span>
<span id="cb22-769"><a href="#cb22-769" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-770"><a href="#cb22-770" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-771"><a href="#cb22-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-772"><a href="#cb22-772" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop any counts that had no usable context</span></span>
<span id="cb22-773"><a href="#cb22-773" aria-hidden="true" tabindex="-1"></a>abrams_count_surfaces <span class="ot">&lt;-</span> abrams_count_surfaces <span class="sc">%&gt;%</span></span>
<span id="cb22-774"><a href="#cb22-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(decision_value))</span>
<span id="cb22-775"><a href="#cb22-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-776"><a href="#cb22-776" aria-hidden="true" tabindex="-1"></a><span class="co"># Symmetric color limits across all counts</span></span>
<span id="cb22-777"><a href="#cb22-777" aria-hidden="true" tabindex="-1"></a>max_abs_dv <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(abrams_count_surfaces<span class="sc">$</span>decision_value), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-778"><a href="#cb22-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-779"><a href="#cb22-779" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot faceted decision surfaces by count</span></span>
<span id="cb22-780"><a href="#cb22-780" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(abrams_count_surfaces,</span>
<span id="cb22-781"><a href="#cb22-781" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> plate_x, <span class="at">y =</span> plate_z, <span class="at">fill =</span> decision_value)) <span class="sc">+</span></span>
<span id="cb22-782"><a href="#cb22-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb22-783"><a href="#cb22-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb22-784"><a href="#cb22-784" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb22-785"><a href="#cb22-785" aria-hidden="true" tabindex="-1"></a>    <span class="at">low  =</span> <span class="st">"#2166ac"</span>,   <span class="co"># strong blue for take-favored</span></span>
<span id="cb22-786"><a href="#cb22-786" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid  =</span> <span class="st">"white"</span>,</span>
<span id="cb22-787"><a href="#cb22-787" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"#b2182b"</span>,   <span class="co"># strong red for swing-favored</span></span>
<span id="cb22-788"><a href="#cb22-788" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>max_abs_dv, max_abs_dv),</span>
<span id="cb22-789"><a href="#cb22-789" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"ERV(swing) - ERV(take)"</span></span>
<span id="cb22-790"><a href="#cb22-790" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-791"><a href="#cb22-791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb22-792"><a href="#cb22-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb22-793"><a href="#cb22-793" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rect"</span>,</span>
<span id="cb22-794"><a href="#cb22-794" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">0.83</span>, <span class="at">xmax =</span> <span class="fl">0.83</span>,</span>
<span id="cb22-795"><a href="#cb22-795" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="fl">1.5</span>,  <span class="at">ymax =</span> <span class="fl">3.5</span>,</span>
<span id="cb22-796"><a href="#cb22-796" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span></span>
<span id="cb22-797"><a href="#cb22-797" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-798"><a href="#cb22-798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> count_str) <span class="sc">+</span></span>
<span id="cb22-799"><a href="#cb22-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-800"><a href="#cb22-800" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"CJ Abrams Decision Value Surfaces by Count"</span>,</span>
<span id="cb22-801"><a href="#cb22-801" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"ERV(swing) - ERV(take), Monte Carlo over Abrams' own contexts"</span>,</span>
<span id="cb22-802"><a href="#cb22-802" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Plate X (ft, catcher view)"</span>,</span>
<span id="cb22-803"><a href="#cb22-803" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Plate Z (ft)"</span></span>
<span id="cb22-804"><a href="#cb22-804" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-805"><a href="#cb22-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb22-806"><a href="#cb22-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-807"><a href="#cb22-807" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb22-808"><a href="#cb22-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-809"><a href="#cb22-809" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusion</span></span>
<span id="cb22-810"><a href="#cb22-810" aria-hidden="true" tabindex="-1"></a>This project builds a fully operational, pitch-by-pitch swing–take decision model grounded in Expected Run Value (ERV). By separating swing and take outcomes, modeling their probabilities independently, and recombining them into a unified decision value framework, we can evaluate not only what happened on a pitch, but what should have happened. The analytics pipeline successfully maps decision value across the strike zone, by count, pitch type, and even for individual hitters, demonstrating that the model captures real-world baseball logic (e.g., protect mode on two strikes, auto-take counts, and the shifting value of aggression). From a practical MLB perspective, this provides a quantitative lens for coaching swing decisions, comparing hitters’ judgment ability, identifying zones where players are leaving value on the table, and optimizing approach plans. While this version is already valuable, future enhancements such as hitter- and pitcher-specific models, improved xwOBA-based outcome modeling, smoother Monte Carlo surfaces, and integrating pitch intent would sharpen the system further and push it toward front-office grade decision-tooling.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>